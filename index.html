<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIVARANX - eGov. + non-Gov. Services Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary: #6C4DF6;
            --secondary: #3D2B8E;
            --accent: #FF7D59;
            --dark: #1A1C2A;
            --light: #F9FAFF;
            --glass: rgba(255, 255, 255, 0.12);
            --success: #4BB543;
            --danger: #f72585;
            --progress: #4cc9f0;
            --warning: #ffcc00;
            
            /* Service Category Colors */
            --national: #4361ee; --state: #7209b7; --tax: #f72585;
            --banking: #4895ef; --insurance: #4cc9f0; --utility: #3a0ca3;
            --booking: #560bad; --health: #b5179e; --education: #480ca8;
            --employment: #3f37c9; --legal: #4895ef; --design: #4cc9f0;
            --it: #4361ee; --startup: #f72585; --smart: #7209b7; /* Fixed variable name */
            --agriculture: #3a0ca3;
            --transport: #4895ef;
            --housing: #4cc9f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Manrope', sans-serif; }

        body {
            background: var(--dark); color: var(--light);
            min-height: 100vh; overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(108, 77, 246, 0.15) 0%, transparent 35%),
                radial-gradient(circle at 80% 70%, rgba(255, 125, 89, 0.15) 0%, transparent 35%);
        }
        
        /* --- Splash Screen & Intro Sequence --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark); z-index: 10000;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            transition: opacity 0.8s ease-out;
        }
        .splash-content {
            display: none; justify-content: center; align-items: center;
            flex-direction: column; text-align: center; width: 90%; max-width: 400px;
        }
        .splash-content.visible { display: flex; animation: fadeIn 0.8s ease-in-out; }
        
        /* New Logo Animation for Splash Screen */
        #logo-intro .logo-image {
            width: 120px; height: 120px; border-radius: 25px;
            animation: logo-entry 1.5s cubic-bezier(0.23, 1, 0.32, 1);
            object-fit: contain;
        }
        #logo-intro .logo-text h1 { font-size: 2.5rem; margin-top: 20px; animation: fadeIn 2s 0.5s both; }
        @keyframes logo-entry { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        #intro-slides .slide { display: none; }
        #intro-slides .slide.active { display: block; animation: fadeIn 0.5s; }
        #intro-slides h2 { font-size: 1.8rem; margin-bottom: 15px; color: var(--primary); }
        #intro-slides p { font-size: 1rem; opacity: 0.8; }
        #fingerprint-scanner { width: 180px; height: 180px; position: relative; cursor: pointer; }
        .fingerprint-icon { font-size: 80px; color: var(--primary); transition: color 0.3s; }
        #fingerprint-scanner:hover .fingerprint-icon { color: var(--accent); }
        .scanner-circle {
            width: 100%; height: 100%; border: 2px solid var(--primary); border-radius: 50%;
            position: absolute; top: 0; left: 0; opacity: 0.3;
            animation: scanner-pulse 2s infinite ease-out;
        }
        .scanner-circle:nth-child(2) { animation-delay: 0.5s; }
        .scan-line {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 100%; height: 4px; border-radius: 4px; 
            background: linear-gradient(to right, transparent, var(--accent), transparent);
            display: none;
        }
        #fingerprint-scanner.scanning .scan-line { display: block; animation: scan-move 1.5s linear; }
        #fingerprint-scanner.scanning .fingerprint-icon { animation: fingerprint-throb 1.5s; }
        #fingerprint-scanner.success .fingerprint-icon { color: var(--success); animation: none; }
        #fingerprint-scanner.success .scanner-circle { border-color: var(--success); animation: none; }
        @keyframes scanner-pulse { 0% { transform: scale(0.8); opacity: 0.3; } 70% { transform: scale(1.2); opacity: 0; } 100% { transform: scale(1.2); opacity: 0; } }
        @keyframes fingerprint-throb { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes scan-move { 0% { top: 0; } 100% { top: 100%; } }

        /* --- App Header --- */
        .app-header {
            background: var(--glass); backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.08); padding: 18px 20px;
            display: flex; justify-content: space-between; align-items: center;
            position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
            transform: translateY(-100%); transition: transform 0.5s ease-out;
        }
        .app-header.visible { transform: translateY(0); }
        .logo { display: flex; align-items: center; gap: 12px; }
        
        /* New Logo Image Styling for Header */
        .logo-image-header {
            width: 42px; height: 42px;
            border-radius: 12px;
            object-fit: contain;
            box-shadow: 0 8px 32px rgba(108, 77, 246, 0.4);
            position: relative;
            overflow: hidden;
            animation: header-logo-pulse 2s infinite ease-in-out;
        }
        @keyframes header-logo-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 8px 32px rgba(108, 77, 246, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 12px 45px rgba(108, 77, 246, 0.6); }
        }

        .logo-text h1 {
            font-size: 1.5rem; font-weight: 800; letter-spacing: -0.5px;
            background: linear-gradient(90deg, #6C4DF6, #FF7D59, #fff, #6C4DF6);
            background-size: 300% auto; -webkit-background-clip: text;
            -webkit-text-fill-color: transparent; text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            animation: gradient-flow 5s linear infinite;
        }
        @keyframes gradient-flow { 0% { background-position: 0% center; } 100% { background-position: 300% center; } }
        .header-actions { display: flex; gap: 15px; }
        .header-btn {
            width: 40px; height: 40px; border-radius: 12px; background: var(--glass);
            border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center;
            justify-content: center; color: var(--light); cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .header-btn:hover {
            transform: translateY(-3px); background: rgba(108, 77, 246, 0.2);
            box-shadow: 0 5px 15px rgba(108, 77, 246, 0.3);
        }
        .badge {
            position: absolute; top: -5px; right: -5px; background: var(--accent);
            color: var(--dark); border-radius: 50%; width: 18px; height: 18px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.6rem; font-weight: 800;
        }

        /* --- Main Container & General Styles --- */
        .app-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 90px 20px 120px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            width: 100%;
        }
        .app-container.visible { opacity: 1; }
        .hero-card {
            background: var(--glass); backdrop-filter: blur(10px); border-radius: 24px;
            padding: 25px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2); position: relative; overflow: hidden;
            animation: cardFloat 6s ease-in-out infinite;
        }
        @keyframes cardFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        .hero-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 10px;
            line-height: 1.2;
            background: linear-gradient(to right, #ffffff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .hero-text { font-size: 0.95rem; opacity: 0.7; margin-bottom: 20px; line-height: 1.6; }
        .search-bar {
            display: flex; background: rgba(10, 12, 20, 0.6); border-radius: 50px;
            padding: 12px 20px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255,255,255,0.05); transition: all 0.4s;
        }
        .search-bar:focus-within {
            transform: translateY(-3px); box-shadow: 0 8px 25px rgba(108, 77, 246, 0.4);
            border: 1px solid rgba(108, 77, 246, 0.3);
        }
        .search-bar input {
            flex: 1; border: none; outline: none; background: transparent;
            color: var(--light); font-size: 0.95rem; padding: 0 10px;
        }
        .search-bar input::placeholder { color: rgba(255,255,255,0.4); }
        .search-bar button { background: none; border: none; color: var(--accent); cursor: pointer; transition: transform 0.3s; }
        .search-bar button:hover { transform: scale(1.1); }
        .initiative-highlight {
            text-align: center; margin: -10px 0 30px 0; font-weight: 600;
            font-size: 0.9rem; opacity: 0.7; letter-spacing: 0.5px;
            background: linear-gradient(90deg, #6C4DF6, #FF7D59);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* --- Services Section --- */
        .services-section { margin-bottom: 35px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .section-title { font-size: 1.3rem; font-weight: 800; }
        .services-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px; }
        .service-card {
            background: rgba(20, 22, 40, 0.6); border-radius: 18px; padding: 15px 10px;
            text-align: center; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.4);
            cursor: pointer; position: relative; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .service-card::before {
            content: ''; position: absolute; top: 0; left: 0;
            width: 100%; height: 3px; transition: all 0.4s;
        }
        .service-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 12px 30px rgba(108, 77, 246, 0.3);
            background: rgba(30, 32, 50, 0.8);
            border: 1px solid rgba(108, 77, 246, 0.3);
        }
        .service-icon {
            width: 45px; height: 45px; margin: 0 auto 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 14px; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 1.2rem; box-shadow: 0 5px 15px rgba(108, 77, 246, 0.4);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.4);
        }
        .service-card:hover .service-icon {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, var(--accent), #FF9A76);
        }
        .service-name { font-size: 0.7rem; font-weight: 600; opacity: 0.8; line-height: 1.3; }
        .service-card[data-category="national"]::before { background: var(--national); } .service-card[data-category="state"]::before { background: var(--state); }
        .service-card[data-category="tax"]::before { background: var(--tax); } .service-card[data-category="banking"]::before { background: var(--banking); }
        .service-card[data-category="insurance"]::before { background: var(--insurance); } .service-card[data-category="utility"]::before { background: var(--utility); }
        .service-card[data-category="booking"]::before { background: var(--booking); } .service-card[data-category="health"]::before { background: var(--health); }
        .service-card[data-category="education"]::before { background: var(--education); } .service-card[data-category="employment"]::before { background: var(--employment); }
        .service-card[data-category="legal"]::before { background: var(--legal); } .service-card[data-category="design"]::before { background: var(--design); }
        .service-card[data-category="it"]::before { background: var(--it); } .service-card[data-category="startup"]::before { background: var(--startup); }
        .service-card[data-category="smart"]::before { background: var(--smart); } /* Fixed variable name */
        .service-card[data-category="agriculture"]::before { background: var(--agriculture); }
        .service-card[data-category="transport"]::before { background: var(--transport); }
        .service-card[data-category="housing"]::before { background: var(--housing); }

        /* --- Modals (Generic) --- */
        .modal {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
            z-index: 2000; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: all 0.4s;
        }
        .modal.active { opacity: 1; pointer-events: all; }
        .modal-content {
            background: var(--dark); border-radius: 24px;
            width: 90%; max-width: 480px; max-height: 90vh;
            overflow-y: auto; padding: 25px; position: relative;
            border: 1px solid rgba(108, 77, 246, 0.3);
            box-shadow: 0 20px 50px rgba(108, 77, 246, 0.3);
            transform: scale(0.95) translateY(20px);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal.active .modal-content { transform: scale(1) translateY(0); }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .modal-title { font-size: 1.4rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .close-modal { background: none; border: none; color: var(--accent); font-size: 1.5rem; cursor: pointer; }

        /* --- Service & Process Modals --- */
        .service-list { display: grid; gap: 12px; }
        .service-item {
            background: rgba(255,255,255,0.05); border-radius: 12px; padding: 12px 15px;
            display: flex; align-items: center; gap: 12px; transition: all 0.3s; cursor: pointer;
        }
        .service-item:hover { background: rgba(108, 77, 246, 0.1); transform: translateX(5px); }
        .process-step { display: flex; gap: 12px; align-items: flex-start; margin-bottom: 15px; }
        .step-number {
            width: 28px; height: 28px; background: rgba(108, 77, 246, 0.2); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 0.8rem;
            font-weight: 700; color: var(--accent); flex-shrink: 0;
        }
        .step-title { font-weight: 700; margin-bottom: 5px; }
        .step-desc { font-size: 0.85rem; opacity: 0.8; line-height: 1.5; }
        .documents-section .section-title, .fees-section .section-title { font-size: 1.1rem; margin-bottom: 15px; }
        .document-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; padding: 8px 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px; }
        .document-item i { color: var(--accent); }
        .fees-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .fees-table tr { border-bottom: 1px solid rgba(255,255,255,0.1); }
        .fees-table td { padding: 10px 0; }
        .fees-table td:last-child { text-align: right; font-weight: 600; }
        .fees-table .highlight { color: var(--accent); }

        /* --- Document Scanner Modal --- */
        .scanner-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .scanner-preview {
            width: 100%;
            height: 300px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .document-preview {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .document-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.3s;
        }

        .ocr-result {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .ocr-result h4 {
            margin-bottom: 10px;
            font-size: 1rem;
            color: var(--accent);
        }

        .extracted-text {
            font-size: 0.85rem;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .document-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
        }

        .document-card:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .document-card img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .document-info {
            flex: 1;
        }

        .document-info h4 {
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        .document-info small {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .document-actions {
            display: flex;
            gap: 10px;
        }

        .scanner-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        /* --- Login Modal --- */
        .login-header { text-align: center; margin-bottom: 30px; }
        .login-logo {
            width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 20px; display: flex; align-items: center; justify-content: center;
            margin: 0 auto 15px; color: white; font-weight: 800; font-size: 1.8rem;
            box-shadow: 0 10px 30px rgba(108, 77, 246, 0.5);
        }
        /* New Login Logo Image Styling */
        .login-logo-image {
            width: 80px; height: 80px; border-radius: 20px;
            object-fit: contain; margin: 0 auto 15px;
            box-shadow: 0 10px 30px rgba(108, 77, 246, 0.5);
        }

        .login-title {
            font-size: 1.8rem; font-weight: 800; margin-bottom: 5px;
            background: linear-gradient(to right, var(--light), #D1D1D1);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .login-subtitle { font-size: 0.9rem; opacity: 0.7; }
        .login-form { display: grid; gap: 15px; }
        .form-footer { text-align: center; margin-top: 20px; font-size: 0.9rem; }
        .form-footer a { color: var(--accent); text-decoration: none; font-weight: 600; }
        
        /* --- Application Form Modal --- */
        .form-section { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .form-section:last-child { border-bottom: none; }
        .form-section-title { font-size: 1.1rem; font-weight: 700; color: var(--primary); margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; }
        .form-control { 
            width: 100%; padding: 12px 15px; background: rgba(255,255,255,0.08); 
            border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; 
            color: var(--light); font-size: 0.95rem; transition: all 0.3s;
        }
        .form-control:focus { 
            outline: none; border-color: var(--primary); 
            box-shadow: 0 0 0 3px rgba(108, 77, 246, 0.2); 
        }
        .form-row { display: flex; gap: 15px; }
        .form-row .form-group { flex: 1; }
        .radio-group label, .checkbox-group label { margin-right: 15px; }
        .upload-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px; background: rgba(255,255,255,0.05); 
            border-radius: 8px; margin-bottom: 8px;
            transition: all 0.3s;
        }
        .upload-item:hover {
            background: rgba(108, 77, 246, 0.1);
        }
        .upload-btn { 
            background: var(--accent); color: var(--dark); padding: 5px 10px; 
            border-radius: 5px; cursor: pointer; font-size: 0.8rem;
            transition: all 0.3s;
        }
        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(255, 125, 89, 0.3);
        }
        .signature-pad { width: 100%; height: 80px; background: rgba(255,255,255,0.08); border: 1px dashed rgba(255,255,255,0.2); border-radius: 8px; }
        .form-actions { display: flex; gap: 15px; margin-top: 20px; }
        
        /* --- Payment & Receipt Modals --- */
        .payment-amount { text-align: center; margin: 25px 0; }
        .amount-label { font-size: 1rem; opacity: 0.8; margin-bottom: 5px; }
        .amount-value { font-size: 2.5rem; font-weight: 800; color: var(--accent); }
        .receipt-details { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 25px; }
        .receipt-row { display: flex; justify-content: space-between; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .receipt-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .receipt-label { font-size: 0.9rem; opacity: 0.8; }
        .receipt-value { font-weight: 600; }
        .receipt-actions { display: grid; gap: 12px; }

        /* --- Discover Modal --- */
        .discover-card { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .discover-card h3 { font-size: 1.2rem; color: var(--primary); margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .discover-card p { font-size: 0.9rem; opacity: 0.8; line-height: 1.6; }
        .founder-profile { display: flex; align-items: center; gap: 20px; }
        .founder-profile img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; }
        .founder-info h4 { font-size: 1.3rem; margin-bottom: 5px; }
        .founder-info p { font-size: 0.9rem; opacity: 0.7; }
        .founder-bio { margin-top: 15px; font-style: italic; opacity: 0.9; }
        .map-placeholder { width: 100%; height: 150px; border-radius: 12px; background: #333; display: flex; align-items: center; justify-content: center; margin-top: 15px; }
        .social-links { display: flex; gap: 20px; margin-top: 15px; }
        .social-links a { color: var(--light); font-size: 1.5rem; transition: color 0.3s; }
        .social-links a:hover { color: var(--accent); }

        /* --- Updates Modal --- */
        .update-list { display: grid; gap: 15px; }
        .update-card { display: flex; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; }
        .update-icon { font-size: 1.5rem; color: var(--accent); padding-top: 5px; }
        .update-content h4 { font-weight: 700; margin-bottom: 5px; }
        .update-content p { font-size: 0.9rem; opacity: 0.8; line-height: 1.5; }
        .update-date { font-size: 0.75rem; opacity: 0.6; margin-top: 8px; }

        /* --- Profile Modal --- */
        .profile-header { text-align: center; margin-bottom: 20px; }
        .profile-avatar {
            width: 100px; height: 100px; border-radius: 50%; 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex; align-items: center; justify-content: center; 
            font-size: 2.5rem; font-weight: 700; margin: 0 auto 15px;
            box-shadow: 0 10px 30px rgba(108, 77, 246, 0.5);
            position: relative;
            overflow: hidden;
        }
        .profile-avatar::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(to bottom right, transparent, rgba(255,255,255,0.2), transparent);
            transform: rotate(60deg); animation: shine 6s infinite;
        }
        .profile-info h3 { 
            font-size: 1.6rem; 
            margin-bottom: 5px;
            background: linear-gradient(to right, var(--light), #D1D1D1);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .profile-info p { opacity: 0.7; font-size: 0.9rem; }
        .profile-stats { 
            display: flex; justify-content: space-around; 
            background: rgba(255,255,255,0.05); padding: 15px; 
            border-radius: 12px; margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-item { text-align: center; }
        .stat-item .stat-value { 
            font-size: 1.2rem; font-weight: 700; 
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .stat-item .stat-label { font-size: 0.8rem; opacity: 0.7; }
        .profile-menu { display: grid; gap: 10px; }
        .profile-menu-item {
            display: flex; align-items: center; gap: 15px; padding: 15px;
            border-radius: 12px; background: rgba(255,255,255,0.05);
            transition: all 0.3s; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .profile-menu-item:hover { 
            background: rgba(255,255,255,0.1);
            border-color: rgba(108, 77, 246, 0.3);
            transform: translateX(5px);
        }
        .profile-menu-item i { 
            width: 24px; height: 24px; 
            background: rgba(108, 77, 246, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent); 
            font-size: 1rem; 
        }
        .profile-menu-item span {
            flex: 1;
            font-size: 0.95rem;
        }
        .logout-btn { 
            margin-top: 20px; 
            background: rgba(247, 37, 133, 0.2); 
            color: var(--danger);
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .logout-btn:hover {
            background: rgba(247, 37, 133, 0.3);
        }
        .last-login { text-align: center; font-size: 0.8rem; opacity: 0.5; margin-top: 20px; }

       /* --- Bottom Navigation (Mobile First - Perfectly Responsive) --- */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(26, 28, 42, 0.98);
    backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    z-index: 1000;
    transform: translateY(100%);
    transition: transform 0.5s ease-out;
    gap: 4px;
}

.bottom-nav.visible {
    transform: translateY(0);
}

.nav-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: rgba(255, 255, 255, 0.6);
    gap: 3px;
    transition: all 0.3s ease-in-out;
    min-width: 0;
    padding: 4px 2px;
}

.nav-item.active {
    color: #fff;
}

.nav-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    background: rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease-in-out;
    flex-shrink: 0;
}

.nav-item.active .nav-icon {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    box-shadow: 0 4px 12px rgba(108, 77, 246, 0.4);
    transform: translateY(-2px);
}

.nav-label {
    font-size: 0.65rem;
    font-weight: 600;
    letter-spacing: 0.2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
    text-align: center;
}

/* Very Small Mobile Phones */
@media (max-width: 360px) {
    .bottom-nav {
        padding: 6px 8px;
        gap: 2px;
    }
    
    .nav-item {
        gap: 2px;
        padding: 3px 1px;
    }
    
    .nav-icon {
        width: 34px;
        height: 34px;
        font-size: 1rem;
        border-radius: 10px;
    }
    
    .nav-label {
        font-size: 0.6rem;
    }
}

/* Standard Mobile Phones */
@media (min-width: 361px) and (max-width: 480px) {
    .bottom-nav {
        padding: 8px 12px;
        gap: 4px;
    }
    
    .nav-item {
        gap: 3px;
        padding: 4px 2px;
    }
    
    .nav-icon {
        width: 38px;
        height: 38px;
        font-size: 1.1rem;
        border-radius: 11px;
    }
    
    .nav-label {
        font-size: 0.65rem;
    }
}

/* Tablets */
@media (min-width: 481px) and (max-width: 768px) {
    .bottom-nav {
        padding: 10px 20px;
        gap: 6px;
    }
    
    .nav-item {
        gap: 4px;
        padding: 5px 3px;
    }
    
    .nav-icon {
        width: 44px;
        height: 44px;
        font-size: 1.2rem;
        border-radius: 12px;
    }
    
    .nav-label {
        font-size: 0.7rem;
    }
    
    .nav-item.active .nav-icon {
        transform: translateY(-3px);
    }
}

/* Large Tablets and Small Laptops */
@media (min-width: 769px) and (max-width: 1024px) {
    .bottom-nav {
        padding: 12px 25px;
        gap: 8px;
    }
    
    .nav-item {
        gap: 5px;
        padding: 6px 4px;
    }
    
    .nav-icon {
        width: 48px;
        height: 48px;
        font-size: 1.3rem;
        border-radius: 14px;
    }
    
    .nav-label {
        font-size: 0.75rem;
    }
    
    .nav-item.active .nav-icon {
        transform: translateY(-4px);
    }
}

/* Desktop and Large Screens */
@media (min-width: 1025px) {
    .bottom-nav {
        max-width: 600px;
        margin: 0 auto;
        border-radius: 16px 16px 0 0;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        padding: 14px 30px;
        left: 50%;
        transform: translateX(-50%) translateY(100%);
        gap: 10px;
    }
    
    .bottom-nav.visible {
        transform: translateX(-50%) translateY(0);
    }
    
    .nav-item {
        gap: 6px;
        padding: 8px 5px;
    }
    
    .nav-icon {
        width: 52px;
        height: 52px;
        font-size: 1.4rem;
        border-radius: 16px;
    }
    
    .nav-label {
        font-size: 0.8rem;
    }
    
    .nav-item.active .nav-icon {
        transform: translateY(-5px);
    }
}

/* Extra Large Screens */
@media (min-width: 1440px) {
    .bottom-nav {
        max-width: 650px;
        padding: 16px 35px;
    }
    
    .nav-icon {
        width: 54px;
        height: 54px;
        font-size: 1.45rem;
    }
    
    .nav-label {
        font-size: 0.82rem;
    }
}

/* Touch device improvements */
@media (hover: none) and (pointer: coarse) {
    .nav-item {
        min-height: 44px; /* Minimum touch target size */
    }
    
    .nav-icon {
        cursor: pointer;
    }
}
        
        /* --- Toast Notification --- */
        #toast-notification {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: var(--glass); backdrop-filter: blur(10px); color: var(--light);
            padding: 12px 25px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 9999; opacity: 0;
            transition: opacity 0.3s, transform 0.3s; pointer-events: none;
        }
        #toast-notification.show { opacity: 1; transform: translateX(-50%) translateY(-20px); pointer-events: all; }
        #toast-notification.success { background: rgba(75, 181, 67, 0.5); border-color: rgba(75, 181, 67, 0.8); }
        #toast-notification.error { background: rgba(247, 37, 133, 0.5); border-color: rgba(247, 37, 133, 0.8); }
        #toast-notification.info { background: rgba(76, 201, 240, 0.5); border-color: rgba(76, 201, 240, 0.8); }
        #toast-notification.warning { background: rgba(255, 204, 0, 0.5); border-color: rgba(255, 204, 0, 0.8); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- Buttons --- */
        .btn {
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 5px 15px rgba(108, 77, 246, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(108, 77, 246, 0.6);
        }

        .btn-outline {
            background: transparent;
            color: var(--light);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-outline:hover {
            background: rgba(255,255,255,0.05);
            border-color: var(--primary);
        }

        /* --- Document Verification --- */
        .verification-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .verification-step {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        .verification-step.completed {
            border-left-color: var(--success);
        }

        .verification-step.in-progress {
            border-left-color: var(--progress);
        }

        .verification-step-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(108, 77, 246, 0.2);
            color: var(--primary);
            flex-shrink: 0;
        }

        .verification-step.completed .verification-step-icon {
            background: rgba(75, 181, 67, 0.2);
            color: var(--success);
        }

        .verification-step.in-progress .verification-step-icon {
            background: rgba(76, 201, 240, 0.2);
            color: var(--progress);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .verification-step-content {
            flex: 1;
        }

        .verification-step-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .verification-step-desc {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* --- Document Preview Modal --- */
        .document-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .document-preview-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .document-preview-content {
            position: relative;
            max-width: 90%;
            max-height: 90vh;
        }

        .document-preview-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .close-preview {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 40px;
            height: 40px;
            background: var(--danger);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

      

        /* --- Activity Timeline --- */
        .timeline {
            position: relative;
            padding-left: 30px;
            margin: 20px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 10px;
            width: 2px;
            background: rgba(108, 77, 246, 0.3);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            top: 5px;
            left: -30px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            border: 2px solid var(--secondary);
        }

        .timeline-date {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .timeline-content {
            background: rgba(255,255,255,0.05);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .timeline-content i {
            color: var(--accent);
            margin-right: 5px;
        }

        /* --- Document Upload Status --- */
        .upload-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .upload-status-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(108, 77, 246, 0.2);
            color: var(--primary);
            flex-shrink: 0;
        }

        .upload-status.success .upload-status-icon {
            background: rgba(75, 181, 67, 0.2);
            color: var(--success);
        }

        .upload-status.error .upload-status-icon {
            background: rgba(247, 37, 133, 0.2);
            color: var(--danger);
        }

        .upload-status-info {
            flex: 1;
        }

        .upload-status-name {
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .upload-status-desc {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        /* Media Queries for Responsiveness */
        @media (min-width: 600px) {
            .app-container {
                max-width: 768px;
                padding: 90px 40px 120px;
            }
            .services-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            .modal-content {
                width: 70%;
            }
        }

        @media (min-width: 1024px) {
            .app-container {
                max-width: 960px;
                padding: 90px 60px 120px;
            }
            .services-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            .chatbot-container {
                width: 400px;
            }
            .modal-content {
                max-width: 550px;
            }
        }

        /* AI Eligibility Section Styles */
        .ai-eligibility-section {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .ai-eligibility-section .section-title {
            color: var(--accent);
            margin-bottom: 15px;
        }

        .ai-eligibility-section textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: var(--light);
            font-size: 0.95rem;
            resize: vertical;
            margin-bottom: 15px;
        }

        .ai-eligibility-section textarea::placeholder {
            color: rgba(255,255,255,0.4);
        }

        .ai-eligibility-section .btn {
            width: 100%;
        }

        .ai-eligibility-results {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.8;
            white-space: pre-wrap;
            text-align: left;
        }

        .ai-eligibility-results.loading {
            color: var(--progress);
        }

        .ai-eligibility-results.error {
            color: var(--danger);
        }
    </style>
</head>
<body>
    <!-- App Intro Sequence -->
    <div id="splash-screen">
        <div id="logo-intro" class="splash-content visible">
            <img src="https://img1.wsimg.com/isteam/ip/e8186a9b-5cfd-4d09-9ac8-87df4de0cc9e/NivaranX%E2%84%A2.png" alt="NIVARANX Logo" class="logo-image">
            <div class="logo-text"><h1>NIVARANX</h1></div>
        </div>
        <div id="intro-slides" class="splash-content">
            <div class="slide active"><h2>Welcome to NIVARANX</h2><p>Aapki sabhi eGov. + Non-Gov. sevaayein, ek hi sthan par.</p></div>
            <div class="slide"><h2>N.I.V.A.R.A.N.X.</h2><p>National Initiative for Virtual Assistance and Resolution Across Nations Xperience</p></div>
            <div class="slide"><h2>Bharosa. Seva. Safalta.</h2><p>Aapka vishwas, hamari pratibaddhata.</p></div>
        </div>
        <div id="fingerprint-scanner" class="splash-content"><div class="scanner-circle"></div><div class="scanner-circle"></div><i class="fas fa-fingerprint fingerprint-icon"></i><div class="scan-line"></div><p style="margin-top: 20px; opacity: 0.7;">Authenticate karne ke liye tap karein</p></div>
    </div>
    
    <!-- App Header -->
    <header class="app-header">
        <div class="logo">
            <img src="https://img1.wsimg.com/isteam/ip/e8186a9b-5cfd-4d09-9ac8-87df4de0cc9e/NivaranX%E2%84%A2.png" alt="NIVARANX Logo" class="logo-image-header">
            <div class="logo-text"><h1>NIVARANX</h1></div>
        </div>
        <div class="header-actions">
            <button class="header-btn"><i class="fas fa-search"></i></button>
            <button class="header-btn"><i class="fas fa-bell"></i><span class="badge">3</span></button>
        </div>
    </header>

    <!-- Main App Content -->
    <div class="app-container">
        <div class="hero-card">
            <h1 class="hero-title">Sabhi eGov. + non-Gov. Sevaayein</h1>
            <p class="hero-text">Bharosa. Seva. Safalta.</p>
            <div class="search-bar">
                <input type="text" id="serviceSearchInput" placeholder="Kisi bhi seva ke liye search karein...">
                <button><i class="fas fa-microphone"></i></button>
            </div>
        </div>
        <div class="initiative-highlight">An Initiative By UPADHYAYG</div>

        <!-- New AI Eligibility Section -->
        <div class="ai-eligibility-section">
            <h2 class="section-title"><i class="fas fa-robot"></i> AI Eligibility Assistant ✨</h2>
            <p style="font-size: 0.9rem; opacity: 0.7; margin-bottom: 15px;">अपनी ज़रूरतें बताएं और AI आपको सही सेवा ढूंढने में मदद करेगा।</p>
            <textarea id="eligibilityQuery" placeholder="उदाहरण: मैं एक किसान हूँ और मुझे सरकारी सहायता चाहिए। मेरी वार्षिक आय ₹3 लाख है।"></textarea>
            <button class="btn btn-primary" onclick="checkEligibilityWithAI()">
                <i class="fas fa-magic"></i> पात्रता जांचें ✨
            </button>
            <div id="eligibilityResults" class="ai-eligibility-results">
                यहां AI-आधारित सुझाव दिखाई देंगे।
            </div>
        </div>

        <div class="services-section">
            <div class="section-header">
                <h2 class="section-title" id="servicesSectionTitle">All Services</h2>
            </div>
            <div class="services-grid" id="servicesGrid"></div>
            <p id="noServicesFound" style="text-align:center; opacity:0.7; display:none; margin-top:20px;">No matching services found.</p>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="serviceModal">
        <div class="modal-content" id="serviceModalContent"></div>
    </div>
    <div class="modal" id="processModal">
        <div class="modal-content" id="processModalContent"></div>
    </div>
    <div class="modal" id="formModal">
        <div class="modal-content" id="formModalContent"></div>
    </div>
    <div class="modal" id="paymentModal">
        <div class="modal-content" id="paymentModalContent"></div>
    </div>
    <div class="modal" id="receiptModal">
        <div class="modal-content" id="receiptModalContent"></div>
    </div>
    <div class="modal" id="loginModal">
        <div class="modal-content" id="loginModalContent"></div>
    </div>
    <div class="modal" id="discoverModal">
        <div class="modal-content" id="discoverModalContent"></div>
    </div>
    <div class="modal" id="updatesModal">
        <div class="modal-content" id="updatesModalContent"></div>
    </div>
    <div class="modal" id="profileModal">
        <div class="modal-content" id="profileModalContent"></div>
    </div>
    <div class="modal" id="documentScannerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-camera"></i> Document Upload</h2>
                <button class="close-modal" onclick="closeAllModals()">&times;</button>
            </div>
            <div id="scannerContainer">
                <div class="scanner-options">
                    <button class="btn btn-primary" id="takePhotoBtn"><i class="fas fa-camera"></i> Take Photo</button>
                    <button class="btn btn-outline" id="uploadPhotoBtn"><i class="fas fa-upload"></i> Upload Image</button>
                </div>
                <div class="scanner-preview">
                    <video id="scannerVideo" autoplay playsinline style="display:none;"></video>
                    <canvas id="scannerCanvas" style="display:none;"></canvas>
                    <div id="scannerResult">
                        <div class="document-preview" id="documentPreview">
                            <p style="opacity:0.7; text-align:center;">Take or upload a clear photo of your document</p>
                        </div>
                        <div class="verification-steps" id="verificationSteps" style="display:none;">
                            <div class="verification-step in-progress" id="step1">
                                <div class="verification-step-icon"><i class="fas fa-image"></i></div>
                                <div class="verification-step-content">
                                    <div class="verification-step-title">Document Upload</div>
                                    <div class="verification-step-desc">Uploading your document for processing</div>
                                </div>
                            </div>
                            <div class="verification-step" id="step2">
                                <div class="verification-step-icon"><i class="fas fa-hourglass-half"></i></div>
                                <div class="verification-step-content">
                                    <div class="verification-step-title">Processing Document</div>
                                    <div class="verification-step-desc">Verifying and preparing document for use</div>
                                </div>
                            </div>
                            <div class="verification-step" id="step3">
                                <div class="verification-step-icon"><i class="fas fa-magic"></i></div>
                                <div class="verification-step-content">
                                    <div class="verification-step-title">OCR Coming Soon</div>
                                    <div class="verification-step-desc">Auto-fill feature will be available soon</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="scanner-actions">
                    <button class="btn btn-outline" id="retryScanBtn" style="display:none;"><i class="fas fa-redo"></i> Retry</button>
                    <button class="btn btn-primary" id="useDocumentBtn" style="display:none;"><i class="fas fa-check-circle"></i> Confirm & Use Document</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Preview Modal -->
    <div class="document-preview-modal" id="documentPreviewModal">
        <div class="document-preview-content">
            <div class="close-preview" onclick="closeDocumentPreview()">&times;</div>
            <img id="fullDocumentPreview" src="" alt="Document Preview">
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-target="home">
            <div class="nav-icon"><i class="fas fa-home"></i></div>
            <span class="nav-label">Home</span>
        </a>
        <a href="#" class="nav-item" data-target="discover">
            <div class="nav-icon"><i class="fas fa-compass"></i></div>
            <span class="nav-label">Discover</span>
        </a>
        <a href="#" class="nav-item" data-target="services">
            <div class="nav-icon"><i class="fas fa-infinity"></i></div>
            <span class="nav-label">Services</span>
        </a>
        <a href="#" class="nav-item" data-target="updates">
            <div class="nav-icon"><i class="fas fa-newspaper"></i></div>
            <span class="nav-label">Updates</span>
        </a>
        <a href="#" class="nav-item" data-target="profile">
            <div class="nav-icon"><i class="fas fa-user"></i></div>
            <span class="nav-label">Profile</span>
        </a>
    </nav>
    
    <!-- Toast Notification -->
    <div id="toast-notification"></div>

    <script>
        // --- Globals & State ---
        let isLoggedIn = false;
        let currentUser = null;
        const appLocation = "Aurangabad, Bihar";
        const appTime = new Date("2025-07-08T16:47:00");
        let currentServiceForForm = null; // Fixed: Declared before use
        let currentFormData = null;
        let userDocuments = JSON.parse(localStorage.getItem('userDocuments') || '[]');
        let stream = null; // For camera stream
        let currentDocumentType = null; // To track which document type is being uploaded
        let currentDocumentImage = null; // Stores the image data URL
        let paymentScreenshot = null; // Stores the payment screenshot data URL
        let userActivity = JSON.parse(localStorage.getItem('userActivity') || '[]'); // User activity log
        let chatbotOpen = false;

        // --- Service & Updates Data ---
        const serviceData = {
            national: { 
                name: 'National', 
                icon: 'fa-flag', 
                services: [ 
                    { 
                        name: 'Passport', 
                        icon: 'fa-passport', 
                        fees: { official: 1500, platform: 99, total: 1599}, 
                        docs: ["Aadhaar Card", "PAN Card", "Address Proof", "Photo"],
                        formFields: [
                            { section: "Personal Details", title: "Applicant's Information", fields: [
                                { name: "title", label: "Title", type: "radio", options: ["Shri", "Smt", "Kum"], required: true },
                                { name: "firstName", label: "Given Name (First Name)", type: "text", placeholder: "First Name", required: true },
                                { name: "middleName", label: "Middle Name", type: "text", placeholder: "Middle Name", required: false },
                                { name: "lastName", label: "Surname", type: "text", placeholder: "Surname", required: true },
                                { name: "gender", label: "Gender", type: "radio", options: ["Male", "Female", "Transgender"], required: true },
                                { name: "dob", label: "Date of Birth (DD/MM/YYYY)", type: "date", required: true },
                                { name: "birthPlace", label: "Place of Birth", type: "text", placeholder: "City/Town/Village", required: true },
                                { name: "birthDistrict", label: "District of Birth", type: "text", placeholder: "District", required: true },
                                { name: "birthState", label: "State/UT of Birth", type: "text", placeholder: "State/UT", required: true },
                                { name: "citizenshipType", label: "Citizenship by", type: "radio", options: ["Birth", "Descent", "Registration/Naturalization"], required: true }
                            ]},
                            { section: "Family Details", title: "Parents' and Spouse's Information", fields: [
                                { name: "fatherName", label: "Father's Given Name", type: "text", placeholder: "Father's First Name", required: true },
                                { name: "fatherSurname", label: "Father's Surname", type: "text", placeholder: "Father's Surname", required: true },
                                { name: "motherName", label: "Mother's Given Name", type: "text", placeholder: "Mother's First Name", required: true },
                                { name: "motherSurname", label: "Mother's Surname", type: "text", placeholder: "Mother's Surname", required: true },
                                { name: "maritalStatus", label: "Marital Status", type: "radio", options: ["Single", "Married", "Divorced", "Widower/Widow"], required: true },
                                { name: "spouseName", label: "Spouse's Given Name", type: "text", placeholder: "Spouse's First Name", required: false },
                                { name: "spouseSurname", label: "Spouse's Surname", type: "text", placeholder: "Spouse's Surname", required: false }
                            ]},
                            { section: "Address Details", title: "Present Residential Address", fields: [
                                { name: "houseNo", label: "House No. and Street Name", type: "text", placeholder: "House No., Street Name", required: true },
                                { name: "villageTownCity", label: "Village/Town/City", type: "text", placeholder: "Village/Town/City", required: true },
                                { name: "district", label: "District", type: "text", placeholder: "District", required: true },
                                { name: "state", label: "State/UT", type: "text", placeholder: "State/UT", required: true },
                                { name: "pincode", label: "Pincode", type: "text", placeholder: "Pincode", required: true },
                                { name: "policeStation", label: "Police Station", type: "text", placeholder: "Nearest Police Station", required: true },
                                { name: "mobile", label: "Mobile Number", type: "tel", placeholder: "10-digit mobile number", required: true },
                                { name: "email", label: "Email ID", type: "email", placeholder: "Email ID", required: true }
                            ]},
                            { section: "Other Details", title: "Emergency Contact, Identity & Criminal Records", fields: [
                                { name: "emergencyName", label: "Emergency Contact Name", type: "text", placeholder: "Name", required: true },
                                { name: "emergencyMobile", label: "Emergency Contact Mobile", type: "tel", placeholder: "Mobile Number", required: true },
                                { name: "aadhaarNumber", label: "Aadhaar Number", type: "text", placeholder: "12-digit Aadhaar Number", required: false },
                                { name: "panNumber", label: "PAN Number", type: "text", placeholder: "PAN Number", required: false },
                                { name: "criminalRecord", label: "Any criminal proceedings pending?", type: "radio", options: ["Yes", "No"], required: true },
                                { name: "passportHeld", label: "Ever held a Passport?", type: "radio", options: ["Yes", "No"], required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Aadhaar Update', 
                        icon: 'fa-id-card', 
                        fees: { official: 50, platform: 49, total: 99}, 
                        docs: ["Existing Aadhaar", "Proof of Identity/Address"],
                        formFields: [
                            { section: "Update Details", title: "Aadhaar Update Request", fields: [
                                { name: "aadhaarNumber", label: "Aadhaar Number", type: "text", placeholder: "12-digit Aadhaar Number", required: true },
                                { name: "updateType", label: "Update Type", type: "checkbox", options: ["Name", "Address", "Date of Birth", "Gender", "Mobile Number", "Email ID", "Biometrics"], required: true },
                                { name: "newName", label: "New Name (if updating)", type: "text", placeholder: "Full Name", required: false },
                                { name: "newAddress", label: "New Address (if updating)", type: "textarea", placeholder: "Full New Address", required: false },
                                { name: "newDob", label: "New Date of Birth (if updating)", type: "date", required: false },
                                { name: "newGender", label: "New Gender (if updating)", type: "radio", options: ["Male", "Female", "Transgender"], required: false },
                                { name: "newMobile", label: "New Mobile Number (if updating)", type: "tel", placeholder: "10-digit Mobile Number", required: false },
                                { name: "newEmail", label: "New Email ID (if updating)", type: "email", placeholder: "Email ID", required: false }
                            ]},
                            { section: "Contact Details", title: "Applicant Contact Information", fields: [
                                { name: "mobile", label: "Registered Mobile Number", type: "tel", placeholder: "10-digit mobile number", required: true },
                                { name: "email", label: "Registered Email", type: "email", placeholder: "Email ID", required: false }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Voter ID Card', 
                        icon: 'fa-vote-yea', 
                        fees: { official: 0, platform: 49, total: 49}, 
                        docs: ["Aadhaar Card", "Address Proof", "Age Proof"],
                        formFields: [
                            { section: "Personal Information", title: "Applicant Details", fields: [
                                { name: "firstName", label: "First Name", type: "text", required: true },
                                { name: "lastName", label: "Last Name", type: "text", required: true },
                                { name: "dob", label: "Date of Birth", type: "date", required: true },
                                { name: "gender", label: "Gender", type: "radio", options: ["Male", "Female", "Other"], required: true }
                            ]},
                            { section: "Address Details", title: "Residential Address", fields: [
                                { name: "address", label: "Full Address", type: "textarea", required: true },
                                { name: "pincode", label: "Pincode", type: "text", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Driving License', 
                        icon: 'fa-car', 
                        fees: { official: 1000, platform: 199, total: 1199}, 
                        docs: ["Aadhaar", "Learner's License", "Medical Certificate"],
                        formFields: [
                            { section: "Applicant Details", title: "Driving License Application", fields: [
                                { name: "fullName", label: "Full Name", type: "text", required: true },
                                { name: "fatherName", label: "Father's Name", type: "text", required: true },
                                { name: "dob", label: "Date of Birth", type: "date", required: true },
                                { name: "bloodGroup", label: "Blood Group", type: "select", options: ["A+", "A-", "B+", "B-", "AB+", "AB-", "O+", "O-"], required: true }
                            ]},
                            { section: "License Type", title: "Vehicle Class", fields: [
                                { name: "vehicleClass", label: "Type of Vehicle", type: "checkbox", options: ["Motorcycle Without Gear", "Motorcycle With Gear", "Light Motor Vehicle", "Transport Vehicle"], required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'PAN Card', 
                        icon: 'fa-credit-card', 
                        fees: { official: 107, platform: 49, total: 156}, 
                        docs: ["Aadhaar Card", "Photo", "Address Proof"],
                        formFields: [
                            { section: "Applicant Details", title: "PAN Card Application", fields: [
                                { name: "category", label: "Category of Applicant", type: "select", options: ["Individual", "HUF", "Company", "Firm", "AOP", "BOI", "Local Authority", "Artificial Juridical Person", "Government"], required: true },
                                { name: "title", label: "Title", type: "radio", options: ["Shri", "Smt", "Kum"], required: true },
                                { name: "lastName", label: "Last Name/Surname", type: "text", required: true },
                                { name: "firstName", label: "First Name", type: "text", required: true },
                                { name: "middleName", label: "Middle Name", type: "text", required: false },
                                { name: "dob", label: "Date of Birth/Incorporation/Formation (DD/MM/YYYY)", type: "date", required: true },
                                { name: "fatherLastName", label: "Father's Last Name/Surname", type: "text", required: true },
                                { name: "fatherFirstName", label: "Father's First Name", type: "text", required: true },
                                { name: "fatherMiddleName", label: "Father's Middle Name", type: "text", required: false }
                            ]},
                            { section: "Contact & Address", title: "Contact and Address Details", fields: [
                                { name: "address", label: "Address for Communication", type: "textarea", required: true },
                                { name: "pincode", label: "Pincode", type: "text", required: true },
                                { name: "email", label: "Email ID", type: "email", required: true },
                                { name: "mobile", label: "Telephone/Mobile Number", type: "tel", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Central Govt. Scheme Application',
                        icon: 'fa-hand-holding-heart',
                        fees: { official: 0, platform: 79, total: 79},
                        docs: ["Aadhaar Card", "Income Certificate", "Caste Certificate (if applicable)"],
                        formFields: [
                            { section: "Scheme Details", title: "Scheme Application", fields: [
                                { name: "schemeName", label: "Scheme Name", type: "text", required: true },
                                { name: "applicantType", label: "Applicant Type", type: "select", options: ["Individual", "Family"], required: true },
                                { name: "income", label: "Annual Family Income (₹)", type: "number", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            state: { 
                name: 'State', 
                icon: 'fa-landmark', 
                services: [ 
                    { 
                        name: 'Ration Card', 
                        icon: 'fa-address-card', 
                        fees: { official: 100, platform: 49, total: 149}, 
                        docs: ["Aadhaar Card", "Income Certificate", "Address Proof"],
                        formFields: [
                            { section: "Applicant Details", title: "Ration Card Application", fields: [
                                { name: "headName", label: "Head of Family Name", type: "text", required: true },
                                { name: "familyMembers", label: "Number of Family Members", type: "number", required: true },
                                { name: "income", label: "Annual Family Income (₹)", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Domicile Certificate', 
                        icon: 'fa-home', 
                        fees: { official: 50, platform: 49, total: 99}, 
                        docs: ["Aadhaar Card", "Birth Certificate", "Address Proof"],
                        formFields: [
                            { section: "Applicant Details", title: "Domicile Certificate Application", fields: [
                                { name: "fullName", label: "Full Name", type: "text", required: true },
                                { name: "fatherName", label: "Father's Name", type: "text", required: true },
                                { name: "residentialPeriod", label: "Period of Residence in State (Years)", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Caste Certificate', 
                        icon: 'fa-users', 
                        fees: { official: 50, platform: 49, total: 99}, 
                        docs: ["Aadhaar", "Father's Caste Certificate", "Address Proof"],
                        formFields: [
                            { section: "Applicant Details", title: "Caste Certificate Application", fields: [
                                { name: "fullName", label: "Full Name", type: "text", required: true },
                                { name: "fatherName", label: "Father's Name", type: "text", required: true },
                                { name: "casteName", label: "Caste Name", type: "text", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Marriage Certificate', 
                        icon: 'fa-ring', 
                        fees: { official: 200, platform: 99, total: 299}, 
                        docs: ["Wedding Card", "Couple's Aadhaar", "Witness IDs"],
                        formFields: [
                            { section: "Couple Details", title: "Marriage Registration", fields: [
                                { name: "groomName", label: "Groom's Full Name", type: "text", required: true },
                                { name: "brideName", label: "Bride's Full Name", type: "text", required: true },
                                { name: "marriageDate", label: "Date of Marriage", type: "date", required: true },
                                { name: "marriagePlace", label: "Place of Marriage", type: "text", required: true }
                            ]}
                        ]
                    },
                    { 
                        name: 'Income Certificate', 
                        icon: 'fa-file-invoice', 
                        fees: { official: 50, platform: 49, total: 99}, 
                        docs: ["Aadhaar", "Ration Card", "Affidavit"],
                        formFields: [
                            { section: "Applicant Details", title: "Income Certificate Application", fields: [
                                { name: "fullName", label: "Full Name", type: "text", required: true },
                                { name: "fatherName", label: "Father's Name", type: "text", required: true },
                                { name: "sourceOfIncome", label: "Source of Income", type: "text", required: true },
                                { name: "annualIncome", label: "Annual Income (₹)", type: "number", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Birth Certificate',
                        icon: 'fa-baby',
                        fees: { official: 50, platform: 49, total: 99},
                        docs: ["Parent's ID", "Hospital Discharge Summary"],
                        formFields: [
                            { section: "Child Details", title: "Birth Registration", fields: [
                                { name: "childName", label: "Child's Name (if any)", type: "text", required: false },
                                { name: "birthDate", label: "Date of Birth", type: "date", required: true },
                                { name: "birthPlace", label: "Place of Birth", type: "text", required: true },
                                { name: "gender", label: "Gender", type: "radio", options: ["Male", "Female", "Other"], required: true }
                            ]},
                            { section: "Parent Details", title: "Parents' Information", fields: [
                                { name: "fatherName", label: "Father's Full Name", type: "text", required: true },
                                { name: "motherName", label: "Mother's Full Name", type: "text", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Death Certificate',
                        icon: 'fa-cross',
                        fees: { official: 50, platform: 49, total: 99},
                        docs: ["Medical Certificate of Cause of Death", "Deceased ID Proof"],
                        formFields: [
                            { section: "Deceased Details", title: "Death Registration", fields: [
                                { name: "deceasedName", label: "Deceased's Full Name", type: "text", required: true },
                                { name: "deathDate", label: "Date of Death", type: "date", required: true },
                                { name: "deathPlace", label: "Place of Death", type: "text", required: true },
                                { name: "causeOfDeath", label: "Cause of Death", type: "textarea", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            tax: { 
                name: 'Tax & Finance', 
                icon: 'fa-file-invoice-dollar', 
                services: [ 
                    { 
                        name: 'Income Tax File', 
                        icon: 'fa-rupee-sign', 
                        fees: { official: 0, platform: 199, total: 199}, 
                        docs: ["PAN Card", "Aadhaar Card", "Bank Statement", "Form 16"],
                        formFields: [
                            { section: "Taxpayer Info", title: "Income Tax Filing", fields: [
                                { name: "pan", label: "PAN", type: "text", required: true },
                                { name: "aadhaar", label: "Aadhaar Number", type: "text", required: true },
                                { name: "assessmentYear", label: "Assessment Year", type: "text", required: true },
                                { name: "incomeSource", label: "Source of Income", type: "text", required: true },
                                { name: "grossIncome", label: "Gross Total Income (₹)", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Property Tax', 
                        icon: 'fa-home', 
                        fees: { official: 'Varies', platform: 99, total: 'Varies'}, 
                        docs: ["Property Deed", "Aadhaar Card"],
                        formFields: [
                            { section: "Property Details", title: "Property Tax Payment", fields: [
                                { name: "propertyId", label: "Property ID", type: "text", required: true },
                                { name: "ownerName", label: "Owner Name", type: "text", required: true },
                                { name: "propertyAddress", label: "Property Address", type: "textarea", required: true },
                                { name: "area", label: "Area (Sq. Ft.)", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'GST Registration', 
                        icon: 'fa-percent', 
                        fees: { official: 0, platform: 499, total: 499}, 
                        docs: ["PAN", "Aadhaar", "Business Address Proof"],
                        formFields: [
                            { section: "Business Details", title: "GST Registration", fields: [
                                { name: "legalName", label: "Legal Name of Business", type: "text", required: true },
                                { name: "tradeName", label: "Trade Name", type: "text", required: true },
                                { name: "businessType", label: "Type of Business", type: "select", options: ["Proprietorship", "Partnership", "Company"], required: true },
                                { name: "businessAddress", label: "Principal Place of Business", type: "textarea", required: true }
                            ]}
                        ]
                    },
                    { 
                        name: 'PF Withdrawal', 
                        icon: 'fa-wallet', 
                        fees: { official: 0, platform: 99, total: 99}, 
                        docs: ["Aadhaar", "PAN", "Bank Details"],
                        formFields: [
                            { section: "PF Details", title: "PF Withdrawal Application", fields: [
                                { name: "uan", label: "UAN (Universal Account Number)", type: "text", required: true },
                                { name: "withdrawalReason", label: "Reason for Withdrawal", type: "select", options: ["Retirement", "Unemployment", "Medical Emergency", "House Purchase"], required: true },
                                { name: "amount", label: "Amount to Withdraw (₹)", type: "number", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Professional Tax Registration',
                        icon: 'fa-briefcase',
                        fees: { official: 'Varies', platform: 149, total: 'Varies'},
                        docs: ["PAN", "Business Registration"],
                        formFields: [
                            { section: "Business Info", title: "Professional Tax Registration", fields: [
                                { name: "businessName", label: "Business Name", type: "text", required: true },
                                { name: "pan", label: "PAN of Entity", type: "text", required: true },
                                { name: "commencementDate", label: "Date of Commencement of Business", type: "date", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            banking: { 
                name: 'Banking', 
                icon: 'fa-university', 
                services: [ 
                    { 
                        name: 'Jan Dhan Account', 
                        icon: 'fa-piggy-bank', 
                        fees: { official: 0, platform: 99, total: 99}, 
                        docs: ["Aadhaar Card", "PAN Card", "Photo"],
                        formFields: [
                            { section: "Account Details", title: "Jan Dhan Account Opening", fields: [
                                { name: "bankName", label: "Preferred Bank", type: "text", required: true },
                                { name: "accountType", label: "Account Type", type: "text", value: "Basic Savings Bank Deposit Account", readonly: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Mudra Loan', 
                        icon: 'fa-hand-holding-usd', 
                        fees: { official: 0, platform: 299, total: 299}, 
                        docs: ["Aadhaar", "PAN", "Business Plan"],
                        formFields: [
                            { section: "Loan Details", title: "Mudra Loan Application", fields: [
                                { name: "loanAmount", label: "Loan Amount (₹)", type: "number", required: true },
                                { name: "businessNature", label: "Nature of Business", type: "text", required: true },
                                { name: "loanCategory", label: "Loan Category", type: "radio", options: ["Shishu (Up to 50k)", "Kishore (50k-5L)", "Tarun (5L-10L)"], required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Atal Pension Yojana', 
                        icon: 'fa-chart-line', 
                        fees: { official: 0, platform: 49, total: 49}, 
                        docs: ["Aadhaar", "Bank Account"],
                        formFields: [
                            { section: "Pension Details", title: "Atal Pension Yojana Enrollment", fields: [
                                { name: "age", label: "Age", type: "number", required: true },
                                { name: "contribution", label: "Desired Monthly Contribution (₹)", type: "number", required: true },
                                { name: "pensionAmount", label: "Desired Monthly Pension (₹)", type: "select", options: ["1000", "2000", "3000", "4000", "5000"], required: true }
                            ]}
                        ]
                    },
                    { 
                        name: 'Sukanya Samriddhi', 
                        icon: 'fa-female', 
                        fees: { official: 0, platform: 49, total: 49}, 
                        docs: ["Birth Certificate", "Aadhaar", "Address Proof"],
                        formFields: [
                            { section: "Child Details", title: "Sukanya Samriddhi Account", fields: [
                                { name: "childName", label: "Girl Child Name", type: "text", required: true },
                                { name: "childDob", label: "Girl Child Date of Birth", type: "date", required: true },
                                { name: "guardianName", label: "Guardian Name", type: "text", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Bank Account Opening',
                        icon: 'fa-money-check-alt',
                        fees: { official: 0, platform: 99, total: 99},
                        docs: ["Aadhaar", "PAN", "Address Proof"],
                        formFields: [
                            { section: "Account Details", title: "New Bank Account Application", fields: [
                                { name: "accountType", label: "Account Type", type: "select", options: ["Savings Account", "Current Account", "Salary Account"], required: true },
                                { name: "initialDeposit", label: "Initial Deposit Amount (₹)", type: "number", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            insurance: { 
                name: 'Insurance', 
                icon: 'fa-shield-alt', 
                services: [ 
                    { 
                        name: 'Ayushman Bharat', 
                        icon: 'fa-user-md', 
                        fees: { official: 0, platform: 149, total: 149}, 
                        docs: ["Aadhaar Card", "Ration Card"],
                        formFields: [
                            { section: "Beneficiary Details", title: "Ayushman Bharat Enrollment", fields: [
                                { name: "familyId", label: "Family ID (from Ration Card)", type: "text", required: true },
                                { name: "membersCount", label: "Number of Family Members", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'PM Jeevan Jyoti Bima', 
                        icon: 'fa-heartbeat', 
                        fees: { official: 436, platform: 49, total: 485}, 
                        docs: ["Aadhaar", "Bank Account"],
                        formFields: [
                            { section: "Policy Details", title: "PMJJBY Enrollment", fields: [
                                { name: "nomineeName", label: "Nominee Name", type: "text", required: true },
                                { name: "relationship", label: "Relationship with Nominee", type: "text", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'PM Suraksha Bima', 
                        icon: 'fa-user-shield', 
                        fees: { official: 20, platform: 29, total: 49}, 
                        docs: ["Aadhaar", "Bank Account"],
                        formFields: [
                            { section: "Policy Details", title: "PMSBY Enrollment", fields: [
                                { name: "nomineeName", label: "Nominee Name", type: "text", required: true },
                                { name: "relationship", label: "Relationship with Nominee", type: "text", required: true }
                            ]}
                        ]
                    },
                    { 
                        name: 'Vehicle Insurance', 
                        icon: 'fa-car-crash', 
                        fees: { official: 'Varies', platform: 99, total: 'Varies'}, 
                        docs: ["RC Book", "Previous Policy"],
                        formFields: [
                            { section: "Vehicle Details", title: "Vehicle Insurance", fields: [
                                { name: "vehicleNumber", label: "Vehicle Registration Number", type: "text", required: true },
                                { name: "makeModel", label: "Make and Model", type: "text", required: true },
                                { name: "policyType", label: "Policy Type", type: "radio", options: ["Third Party", "Comprehensive"], required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Crop Insurance (PMFBY)',
                        icon: 'fa-leaf',
                        fees: { official: 'Varies', platform: 49, total: 'Varies'},
                        docs: ["Land Records", "Aadhaar"],
                        formFields: [
                            { section: "Farm Details", title: "Crop Insurance Application", fields: [
                                { name: "farmerName", label: "Farmer's Name", type: "text", required: true },
                                { name: "cropType", label: "Crop Type", type: "text", required: true },
                                { name: "landArea", label: "Land Area (Acres)", type: "number", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            utility: { 
                name: 'Utility', 
                icon: 'fa-bolt', 
                services: [ 
                    { 
                        name: 'Electricity Bill', 
                        icon: 'fa-lightbulb', 
                        fees: { official: 'Varies', platform: 10, total: 'Varies'}, 
                        docs: ["Consumer ID"],
                        formFields: [
                            { section: "Bill Payment", title: "Electricity Bill Payment", fields: [
                                { name: "consumerId", label: "Consumer ID", type: "text", required: true },
                                { name: "billAmount", label: "Bill Amount (₹)", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Water Bill', 
                        icon: 'fa-tint', 
                        fees: { official: 'Varies', platform: 10, total: 'Varies'}, 
                        docs: ["Consumer ID"],
                        formFields: [
                            { section: "Bill Payment", title: "Water Bill Payment", fields: [
                                { name: "consumerId", label: "Consumer ID", type: "text", required: true },
                                { name: "billAmount", label: "Bill Amount (₹)", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Gas Cylinder Booking', 
                        icon: 'fa-fire', 
                        fees: { official: 'Varies', platform: 15, total: 'Varies'}, 
                        docs: ["Consumer ID"],
                        formFields: [
                            { section: "Booking Details", title: "Gas Cylinder Booking", fields: [
                                { name: "consumerId", label: "Gas Consumer ID", type: "text", required: true },
                                { name: "agency", label: "Gas Agency Name", type: "text", required: true }
                            ]}
                        ]
                    },
                    { 
                        name: 'Broadband Connection', 
                        icon: 'fa-wifi', 
                        fees: { official: 'Varies', platform: 99, total: 'Varies'}, 
                        docs: ["Aadhaar", "Address Proof"],
                        formFields: [
                            { section: "Connection Details", title: "New Broadband Connection", fields: [
                                { name: "provider", label: "Preferred Provider", type: "text", required: true },
                                { name: "plan", label: "Desired Plan", type: "text", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'New Electricity Connection',
                        icon: 'fa-plug',
                        fees: { official: 'Varies', platform: 199, total: 'Varies'},
                        docs: ["ID Proof", "Address Proof", "Property Ownership"],
                        formFields: [
                            { section: "Connection Details", title: "New Electricity Connection", fields: [
                                { name: "connectionType", label: "Connection Type", type: "select", options: ["Domestic", "Commercial", "Industrial"], required: true },
                                { name: "load", label: "Required Load (KW)", type: "number", required: true },
                                { name: "propertyType", label: "Property Type", type: "text", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            booking: { 
                name: 'Booking', 
                icon: 'fa-calendar-check', 
                services: [ 
                    { 
                        name: 'Train Tickets', 
                        icon: 'fa-train', 
                        fees: { official: 'Varies', platform: 20, total: 'Varies'}, 
                        docs: ["Valid ID Proof"],
                        formFields: [
                            { section: "Journey Details", title: "Train Ticket Booking", fields: [
                                { name: "from", label: "From Station", type: "text", required: true },
                                { name: "to", label: "To Station", type: "text", required: true },
                                { name: "date", label: "Date of Journey", type: "date", required: true },
                                { name: "passengers", label: "Number of Passengers", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Bus Tickets', 
                        icon: 'fa-bus', 
                        fees: { official: 'Varies', platform: 15, total: 'Varies'}, 
                        docs: ["Mobile Number"],
                        formFields: [
                            { section: "Journey Details", title: "Bus Ticket Booking", fields: [
                                { name: "from", label: "From City", type: "text", required: true },
                                { name: "to", label: "To City", type: "text", required: true },
                                { name: "date", label: "Date of Journey", type: "date", required: true },
                                { name: "passengers", label: "Number of Passengers", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Doctor Appointment', 
                        icon: 'fa-stethoscope', 
                        fees: { official: 'Varies', platform: 49, total: 'Varies'}, 
                        docs: ["Patient Name"],
                        formFields: [
                            { section: "Appointment Details", title: "Doctor Appointment Booking", fields: [
                                { name: "doctorName", label: "Doctor Name/Specialty", type: "text", required: true },
                                { name: "appointmentDate", label: "Preferred Date", type: "date", required: true },
                                { name: "appointmentTime", label: "Preferred Time", type: "time", required: true },
                                { name: "reason", label: "Reason for Appointment", type: "textarea", required: true }
                            ]}
                        ]
                    },
                    { 
                        name: 'Vaccination Slot', 
                        icon: 'fa-syringe', 
                        fees: { official: 0, platform: 49, total: 49}, 
                        docs: ["Aadhaar Card"],
                        formFields: [
                            { section: "Vaccination Details", title: "Vaccination Slot Booking", fields: [
                                { name: "beneficiaryId", label: "Beneficiary ID (CoWIN)", type: "text", required: true },
                                { name: "vaccineType", label: "Vaccine Type", type: "select", options: ["Covishield", "Covaxin", "Sputnik V"], required: true },
                                { name: "dose", label: "Dose Number", type: "radio", options: ["1st Dose", "2nd Dose", "Booster Dose"], required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Flight Tickets (Domestic)',
                        icon: 'fa-plane',
                        fees: { official: 'Varies', platform: 149, total: 'Varies'},
                        docs: ["ID Proof"],
                        formFields: [
                            { section: "Flight Details", title: "Domestic Flight Booking", fields: [
                                { name: "fromAirport", label: "From (Airport Code)", type: "text", required: true },
                                { name: "toAirport", label: "To (Airport Code)", type: "text", required: true },
                                { name: "travelDate", label: "Travel Date", type: "date", required: true },
                                { name: "passengers", label: "Number of Passengers", type: "number", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            health: { 
                name: 'Healthcare', 
                icon: 'fa-hospital-user', 
                services: [ 
                    { 
                        name: 'Health ID Card', 
                        icon: 'fa-id-badge', 
                        fees: { official: 0, platform: 99, total: 99}, 
                        docs: ["Aadhaar Card"],
                        formFields: [
                            { section: "Applicant Details", title: "Health ID Card Application", fields: [
                                { name: "fullName", label: "Full Name", type: "text", required: true },
                                { name: "aadhaar", label: "Aadhaar Number", type: "text", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Book Lab Test', 
                        icon: 'fa-vial', 
                        fees: { official: 'Varies', platform: 99, total: 'Varies'}, 
                        docs: ["Prescription (if any)"],
                        formFields: [
                            { section: "Test Details", title: "Lab Test Booking", fields: [
                                { name: "testName", label: "Test Name", type: "text", required: true },
                                { name: "labPreference", label: "Preferred Lab (Optional)", type: "text", required: false },
                                { name: "appointmentDate", label: "Preferred Date", type: "date", required: true },
                                { name: "homeCollection", label: "Home Collection Required?", type: "radio", options: ["Yes", "No"], required: true }
                            ]}
                        ]
                    },
                    { 
                        name: 'PMJAY Claim', 
                        icon: 'fa-file-medical', 
                        fees: { official: 0, platform: 199, total: 199}, 
                        docs: ["Ayushman Card", "Hospital Papers"],
                        formFields: [
                            { section: "Claim Details", title: "PMJAY Claim Application", fields: [
                                { name: "ayushmanId", label: "Ayushman Bharat ID", type: "text", required: true },
                                { name: "hospitalName", label: "Hospital Name", type: "text", required: true },
                                { name: "treatmentCost", label: "Estimated Treatment Cost (₹)", type: "number", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Online Doctor Consultation',
                        icon: 'fa-notes-medical',
                        fees: { official: 'Varies', platform: 199, total: 'Varies'},
                        docs: ["Symptoms Description"],
                        formFields: [
                            { section: "Consultation Details", title: "Online Doctor Consultation", fields: [
                                { name: "specialty", label: "Specialty", type: "text", placeholder: "e.g., General Physician, Dermatologist", required: true },
                                { name: "symptoms", label: "Describe your symptoms", type: "textarea", required: true },
                                { name: "preferredLanguage", label: "Preferred Language for Consultation", type: "text", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            education: { 
                name: 'Education', 
                icon: 'fa-graduation-cap', 
                services: [ 
                    { 
                        name: 'Scholarship', 
                        icon: 'fa-book', 
                        fees: { official: 0, platform: 199, total: 199}, 
                        docs: ["Marksheet", "Caste/Income Certificate"],
                        formFields: [
                            { section: "Applicant Details", title: "Scholarship Application", fields: [
                                { name: "studentName", label: "Student Name", type: "text", required: true },
                                { name: "course", label: "Course/Class", type: "text", required: true },
                                { name: "marks", label: "Previous Year Marks (%)", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Exam Results', 
                        icon: 'fa-poll', 
                        fees: { official: 0, platform: 29, total: 29}, 
                        docs: ["Roll Number"],
                        formFields: [
                            { section: "Exam Details", title: "Exam Result Check", fields: [
                                { name: "examName", label: "Exam Name", type: "text", required: true },
                                { name: "rollNumber", label: "Roll Number", type: "text", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Student Credit Card', 
                        icon: 'fa-credit-card', 
                        fees: { official: 0, platform: 249, total: 249}, 
                        docs: ["Admission Letter", "Aadhaar", "PAN"],
                        formFields: [
                            { section: "Student Details", title: "Student Credit Card Application", fields: [
                                { name: "studentName", label: "Student Name", type: "text", required: true },
                                { name: "courseDuration", label: "Course Duration (Years)", type: "number", required: true },
                                { name: "loanAmount", label: "Required Loan Amount (₹)", type: "number", required: true }
                            ]}
                        ]
                    },
                    { 
                        name: 'University Admission', 
                        icon: 'fa-university', 
                        fees: { official: 'Varies', platform: 199, total: 'Varies'}, 
                        docs: ["Marksheets", "ID Proof"],
                        formFields: [
                            { section: "Admission Details", title: "University Admission Application", fields: [
                                { name: "universityName", label: "University Name", type: "text", required: true },
                                { name: "courseName", label: "Course Name", type: "text", required: true },
                                { name: "marks12th", label: "12th Standard Marks (%)", type: "number", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Skill Development Course Enrollment',
                        icon: 'fa-tools',
                        fees: { official: 'Varies', platform: 99, total: 'Varies'},
                        docs: ["Aadhaar"],
                        formFields: [
                            { section: "Course Details", title: "Skill Development Enrollment", fields: [
                                { name: "courseName", label: "Desired Course Name", type: "text", required: true },
                                { name: "qualification", label: "Highest Qualification", type: "text", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            employment: { 
                name: 'Employment', 
                icon: 'fa-briefcase', 
                services: [ 
                    { 
                        name: 'NREGA Job Card', 
                        icon: 'fa-hard-hat', 
                        fees: { official: 0, platform: 99, total: 99}, 
                        docs: ["Aadhaar Card", "Bank Account", "Photo"],
                        formFields: [
                            { section: "Applicant Details", title: "NREGA Job Card Application", fields: [
                                { name: "fullName", label: "Full Name", type: "text", required: true },
                                { name: "familyMembers", label: "Number of Adult Family Members", type: "number", required: true },
                                { name: "jobType", label: "Preferred Job Type", type: "text", required: false }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Skill India Enrollment', 
                        icon: 'fa-tools', 
                        fees: { official: 0, platform: 49, total: 49}, 
                        docs: ["Aadhaar Card"],
                        formFields: [
                            { section: "Enrollment Details", title: "Skill India Enrollment", fields: [
                                { name: "courseInterest", label: "Course of Interest", type: "text", required: true },
                                { name: "educationLevel", label: "Education Level", type: "text", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Find Govt. Jobs', 
                        icon: 'fa-search', 
                        fees: { official: 0, platform: 99, total: 99}, 
                        docs: ["Qualification Details"],
                        formFields: [
                            { section: "Job Search Criteria", title: "Government Job Search", fields: [
                                { name: "qualification", label: "Highest Qualification", type: "text", required: true },
                                { name: "desiredField", label: "Desired Job Field", type: "text", required: true },
                                { name: "locationPreference", label: "Location Preference", type: "text", required: false }
                            ]}
                        ]
                    },
                    { 
                        name: 'EPF Services', 
                        icon: 'fa-file-alt', 
                        fees: { official: 0, platform: 99, total: 99}, 
                        docs: ["UAN Number", "Aadhaar"],
                        formFields: [
                            { section: "EPF Details", title: "EPF Services Request", fields: [
                                { name: "uan", label: "UAN (Universal Account Number)", type: "text", required: true },
                                { name: "serviceType", label: "Service Type", type: "select", options: ["Balance Check", "KYC Update", "Withdrawal Request"], required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Unemployment Allowance',
                        icon: 'fa-money-bill-wave',
                        fees: { official: 0, platform: 149, total: 149},
                        docs: ["Employment Exchange Registration", "Income Certificate"],
                        formFields: [
                            { section: "Allowance Details", title: "Unemployment Allowance Application", fields: [
                                { name: "registrationNumber", label: "Employment Exchange Registration Number", type: "text", required: true },
                                { name: "unemploymentPeriod", label: "Period of Unemployment (Months)", type: "number", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            legal: { 
                name: 'Legal', 
                icon: 'fa-gavel', 
                services: [ 
                    { 
                        name: 'RTI Application', 
                        icon: 'fa-file-alt', 
                        fees: { official: 10, platform: 99, total: 109}, 
                        docs: ["Aadhaar Card", "Application Details"],
                        formFields: [
                            { section: "Application Details", title: "RTI Application", fields: [
                                { name: "publicAuthority", label: "Public Authority Name", type: "text", required: true },
                                { name: "subject", label: "Subject of Information", type: "text", required: true },
                                { name: "details", label: "Detailed Information Required", type: "textarea", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'E-Court Fee Payment', 
                        icon: 'fa-balance-scale', 
                        fees: { official: 'Varies', platform: 49, total: 'Varies'}, 
                        docs: ["Case Number"],
                        formFields: [
                            { section: "Payment Details", title: "E-Court Fee Payment", fields: [
                                { name: "caseNumber", label: "Case Number", type: "text", required: true },
                                { name: "courtName", label: "Court Name", type: "text", required: true },
                                { name: "feeAmount", label: "Fee Amount (₹)", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Legal Aid', 
                        icon: 'fa-hands-helping', 
                        fees: { official: 0, platform: 199, total: 199}, 
                        docs: ["Income Certificate", "Case Details"],
                        formFields: [
                            { section: "Case Details", title: "Legal Aid Application", fields: [
                                { name: "caseType", label: "Type of Case", type: "text", required: true },
                                { name: "briefDescription", label: "Brief Description of Case", type: "textarea", required: true },
                                { name: "income", label: "Annual Income (₹)", type: "number", required: true }
                            ]}
                        ]
                    },
                    { 
                        name: 'Property Registration', 
                        icon: 'fa-file-signature', 
                        fees: { official: 'Varies', platform: 999, total: 'Varies'}, 
                        docs: ["Property Papers", "ID Proof"],
                        formFields: [
                            { section: "Property Details", title: "Property Registration", fields: [
                                { name: "propertyAddress", label: "Property Address", type: "textarea", required: true },
                                { name: "sellerName", label: "Seller's Name", type: "text", required: true },
                                { name: "buyerName", label: "Buyer's Name", type: "text", required: true },
                                { name: "propertyValue", label: "Property Value (₹)", type: "number", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Police Clearance Certificate',
                        icon: 'fa-user-check',
                        fees: { official: 500, platform: 149, total: 649},
                        docs: ["Passport", "Address Proof"],
                        formFields: [
                            { section: "Applicant Details", title: "Police Clearance Certificate", fields: [
                                { name: "purpose", label: "Purpose of PCC", type: "text", required: true },
                                { name: "country", label: "Country for which PCC is required", type: "text", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            design: { 
                name: 'Design', 
                icon: 'fa-pencil-ruler', 
                services: [ 
                    { 
                        name: 'Copyright', 
                        icon: 'fa-copyright', 
                        fees: { official: 500, platform: 499, total: 999}, 
                        docs: ["Work Sample", "Identity Proof"],
                        formFields: [
                            { section: "Work Details", title: "Copyright Registration", fields: [
                                { name: "workTitle", label: "Title of Work", type: "text", required: true },
                                { name: "workType", label: "Type of Work", type: "select", options: ["Literary", "Dramatic", "Musical", "Artistic", "Cinematograph Film", "Sound Recording"], required: true },
                                { name: "authorName", label: "Author's Name", type: "text", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Trademark', 
                        icon: 'fa-trademark', 
                        fees: { official: 4500, platform: 999, total: 5499}, 
                        docs: ["Logo/Brand Name", "Applicant Details"],
                        formFields: [
                            { section: "Trademark Details", title: "Trademark Registration", fields: [
                                { name: "trademarkName", label: "Trademark Name/Logo", type: "text", required: true },
                                { name: "goodsServices", label: "Goods/Services Description", type: "textarea", required: true },
                                { name: "classNumber", label: "Class Number (e.g., 25 for clothing)", type: "number", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            it: { 
                name: 'IT Services', 
                icon: 'fa-server', 
                services: [ 
                    { 
                        name: 'DigiLocker Setup', 
                        icon: 'fa-lock', 
                        fees: { official: 0, platform: 49, total: 49}, 
                        docs: ["Aadhaar-linked Mobile"],
                        formFields: [
                            { section: "Account Setup", title: "DigiLocker Setup", fields: [
                                { name: "aadhaar", label: "Aadhaar Number", type: "text", required: true },
                                { name: "mobileOtp", label: "Mobile OTP (Simulated)", type: "text", placeholder: "Enter OTP", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Cyber Complaint', 
                        icon: 'fa-user-secret', 
                        fees: { official: 0, platform: 149, total: 149}, 
                        docs: ["Complaint Details", "Evidence"],
                        formFields: [
                            { section: "Complaint Details", title: "Cyber Crime Complaint", fields: [
                                { name: "incidentType", label: "Type of Incident", type: "text", required: true },
                                { name: "incidentDate", label: "Date of Incident", type: "date", required: true },
                                { name: "brief", label: "Brief Description of Incident", type: "textarea", required: true },
                                { name: "financialLoss", label: "Financial Loss (if any) (₹)", type: "number", required: false }
                            ]}
                        ]
                    },
                    {
                        name: 'Digital Signature Certificate',
                        icon: 'fa-signature',
                        fees: { official: 'Varies', platform: 299, total: 'Varies'},
                        docs: ["ID Proof", "Address Proof"],
                        formFields: [
                            { section: "Applicant Details", title: "Digital Signature Certificate", fields: [
                                { name: "applicantType", label: "Applicant Type", type: "select", options: ["Individual", "Organization"], required: true },
                                { name: "validity", label: "Validity Period (Years)", type: "select", options: ["1", "2", "3"], required: true }
                            ]}
                        ]
                    }
                ] 
            },
            startup: { 
                name: 'Startup', 
                icon: 'fa-rocket', 
                services: [ 
                    { 
                        name: 'Company Registration', 
                        icon: 'fa-file-signature', 
                        fees: { official: 5000, platform: 999, total: 5999}, 
                        docs: ["Director's PAN/Aadhaar", "Address Proof"],
                        formFields: [
                            { section: "Company Details", title: "Company Registration", fields: [
                                { name: "companyName", label: "Proposed Company Name", type: "text", required: true },
                                { name: "companyType", label: "Type of Company", type: "select", options: ["Private Limited", "Public Limited", "One Person Company"], required: true },
                                { name: "paidUpCapital", label: "Paid-up Capital (₹)", type: "number", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Startup India Reg.', 
                        icon: 'fa-award', 
                        fees: { official: 0, platform: 499, total: 499}, 
                        docs: ["Company Details", "Innovation Pitch"],
                        formFields: [
                            { section: "Startup Details", title: "Startup India Registration", fields: [
                                { name: "entityName", label: "Entity Name", type: "text", required: true },
                                { name: "incorporationDate", label: "Date of Incorporation", type: "date", required: true },
                                { name: "innovationDescription", label: "Description of Innovation", type: "textarea", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'MSME Registration',
                        icon: 'fa-industry',
                        fees: { official: 0, platform: 299, total: 299},
                        docs: ["Aadhaar", "Business Activity Details"],
                        formFields: [
                            { section: "Business Details", title: "MSME Registration", fields: [
                                { name: "enterpriseName", label: "Name of Enterprise", type: "text", required: true },
                                { name: "businessActivity", label: "Major Activity", type: "select", options: ["Manufacturing", "Service"], required: true },
                                { name: "investment", label: "Investment in Plant & Machinery/Equipment (₹)", type: "number", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            smart: { 
                name: 'Smart', 
                icon: 'fa-robot', 
                services: [ 
                    { 
                        name: 'AI Consultation', 
                        icon: 'fa-comment-alt', 
                        fees: { official: 0, platform: 299, total: 299}, 
                        docs: ["Query Details"],
                        formFields: [
                            { section: "Consultation Request", title: "AI Consultation", fields: [
                                { name: "querySubject", label: "Subject of Query", type: "text", required: true },
                                { name: "queryDetails", label: "Detailed Query", type: "textarea", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Smart City Grievance', 
                        icon: 'fa-city', 
                        fees: { official: 0, platform: 49, total: 49}, 
                        docs: ["Grievance Details", "Location"],
                        formFields: [
                            { section: "Grievance Details", title: "Smart City Grievance", fields: [
                                { name: "grievanceType", label: "Type of Grievance", type: "text", required: true },
                                { name: "location", label: "Location of Issue", type: "text", required: true },
                                { name: "description", label: "Description", type: "textarea", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            agriculture: { 
                name: 'Agriculture', 
                icon: 'fa-tractor', 
                services: [ 
                    { 
                        name: 'PM Kisan Yojana', 
                        icon: 'fa-rupee-sign', 
                        fees: { official: 0, platform: 49, total: 49}, 
                        docs: ["Aadhaar", "Land Records"],
                        formFields: [
                            { section: "Farmer Details", title: "PM Kisan Yojana Application", fields: [
                                { name: "farmerName", label: "Farmer's Name", type: "text", required: true },
                                { name: "landHolding", label: "Land Holding (Acres)", type: "number", required: true },
                                { name: "bankAccount", label: "Bank Account Number", type: "text", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Kisan Credit Card', 
                        icon: 'fa-credit-card', 
                        fees: { official: 0, platform: 99, total: 99}, 
                        docs: ["Aadhaar", "Land Records"],
                        formFields: [
                            { section: "Credit Card Details", title: "Kisan Credit Card Application", fields: [
                                { name: "farmerName", label: "Farmer's Name", type: "text", required: true },
                                { name: "cropType", label: "Major Crop Cultivated", type: "text", required: true },
                                { name: "loanAmount", label: "Desired Credit Limit (₹)", type: "number", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Soil Health Card',
                        icon: 'fa-seedling',
                        fees: { official: 0, platform: 29, total: 29},
                        docs: ["Land Records"],
                        formFields: [
                            { section: "Land Details", title: "Soil Health Card Application", fields: [
                                { name: "farmerName", label: "Farmer's Name", type: "text", required: true },
                                { name: "surveyNo", label: "Survey/Khasra Number", type: "text", required: true },
                                { name: "block", label: "Block", type: "text", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            transport: { 
                name: 'Transport', 
                icon: 'fa-truck', 
                services: [ 
                    { 
                        name: 'Vehicle Registration', 
                        icon: 'fa-car', 
                        fees: { official: 'Varies', platform: 299, total: 'Varies'}, 
                        docs: ["Invoice", "Address Proof"],
                        formFields: [
                            { section: "Vehicle Details", title: "Vehicle Registration", fields: [
                                { name: "vehicleType", label: "Vehicle Type", type: "select", options: ["Two-Wheeler", "Four-Wheeler", "Commercial"], required: true },
                                { name: "makeModel", label: "Make and Model", type: "text", required: true },
                                { name: "engineNo", label: "Engine Number", type: "text", required: true },
                                { name: "chassisNo", label: "Chassis Number", type: "text", required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Driving License Renewal', 
                        icon: 'fa-id-card', 
                        fees: { official: 200, platform: 99, total: 299}, 
                        docs: ["Old License", "Medical Certificate"],
                        formFields: [
                            { section: "License Details", title: "Driving License Renewal", fields: [
                                { name: "dlNumber", label: "Driving License Number", type: "text", required: true },
                                { name: "oldDlExpiry", label: "Old License Expiry Date", type: "date", required: true },
                                { name: "medicalFitness", label: "Medical Fitness Certificate Attached?", type: "radio", options: ["Yes", "No"], required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Vehicle Fitness Certificate',
                        icon: 'fa-cogs',
                        fees: { official: 'Varies', platform: 99, total: 'Varies'},
                        docs: ["RC Book"],
                        formFields: [
                            { section: "Vehicle Details", title: "Vehicle Fitness Certificate", fields: [
                                { name: "vehicleNumber", label: "Vehicle Registration Number", type: "text", required: true },
                                { name: "lastFitnessDate", label: "Last Fitness Certificate Date", type: "date", required: false },
                                { name: "inspectionDate", label: "Preferred Inspection Date", type: "date", required: true }
                            ]}
                        ]
                    }
                ] 
            },
            housing: { 
                name: 'Housing', 
                icon: 'fa-home', 
                services: [ 
                    { 
                        name: 'PM Awas Yojana', 
                        icon: 'fa-house-user', 
                        fees: { official: 0, platform: 199, total: 199}, 
                        docs: ["Aadhaar", "Income Certificate"],
                        formFields: [
                            { section: "Applicant Details", title: "PM Awas Yojana Application", fields: [
                                { name: "familyIncome", label: "Annual Family Income (₹)", type: "number", required: true },
                                { name: "houseOwnership", label: "Do you own a Pucca house?", type: "radio", options: ["Yes", "No"], required: true },
                                { name: "schemeComponent", label: "Desired Component", type: "select", options: ["Beneficiary-led Construction", "Affordable Housing in Partnership", "In-situ Slum Redevelopment"], required: true }
                            ]}
                        ]
                    }, 
                    { 
                        name: 'Home Loan Subsidy', 
                        icon: 'fa-hand-holding-usd', 
                        fees: { official: 0, platform: 199, total: 199}, 
                        docs: ["Loan Details", "Aadhaar"],
                        formFields: [
                            { section: "Loan Details", title: "Home Loan Subsidy Application", fields: [
                                { name: "loanProvider", label: "Loan Provider Bank/FI", type: "text", required: true },
                                { name: "loanAmount", label: "Loan Amount (₹)", type: "number", required: true },
                                { name: "emiAmount", label: "Monthly EMI (₹)", type: "number", required: true }
                            ]}
                        ]
                    },
                    {
                        name: 'Property Mutation',
                        icon: 'fa-file-contract',
                        fees: { official: 'Varies', platform: 299, total: 'Varies'},
                        docs: ["Sale Deed", "Previous Mutation Records"],
                        formFields: [
                            { section: "Property Details", title: "Property Mutation Application", fields: [
                                { name: "propertyAddress", label: "Property Address", type: "textarea", required: true },
                                { name: "oldOwner", label: "Previous Owner Name", type: "text", required: true },
                                { name: "newOwner", label: "New Owner Name", type: "text", required: true },
                                { name: "mutationType", label: "Mutation Type", type: "select", options: ["Sale", "Inheritance", "Gift", "Will"], required: true }
                            ]}
                        ]
                    }
                ] 
            }
        };
        
        const updatesData = [
            { 
                icon: 'fa-landmark', 
                title: 'PM-Kisan 19th Installment Released', 
                content: 'The latest installment under the Pradhan Mantri Kisan Samman Nidhi has been disbursed to eligible farmers.', 
                date: 'July 07, 2025' 
            },
            { 
                icon: 'fa-graduation-cap', 
                title: 'New National Education Policy Updates', 
                content: 'Implementation of phase 2 of the NEP begins, focusing on digital literacy and vocational training in schools.', 
                date: 'July 05, 2025' 
            },
            { 
                icon: 'fa-shield-alt', 
                title: 'Ayushman Bharat Digital ID Drive', 
                content: 'A special drive is being conducted to enroll all citizens for the Ayushman Bharat Health Account (ABHA) ID.', 
                date: 'July 02, 2025' 
            },
            { 
                icon: 'fa-camera', 
                title: 'Document OCR Coming Soon', 
                content: 'We are working on integrating advanced OCR technology to automatically extract information from your documents for faster form filling. Stay tuned for updates!', 
                date: 'June 28, 2025' 
            },
            { 
                icon: 'fa-wifi', 
                title: 'BharatNet Phase 3 Launched', 
                content: 'The third phase of BharatNet aims to provide high-speed broadband connectivity to all gram panchayats.', 
                date: 'June 25, 2025' 
            },
            { 
                icon: 'fa-car', 
                title: 'New EV Policy Announced', 
                content: 'Government announces new incentives for electric vehicle adoption to promote sustainable transportation.', 
                date: 'June 20, 2025' 
            }
        ];

        // --- AI Chatbot Knowledge Base ---
        const chatbotKnowledge = {
            greetings: [
                "Namaste! I'm your NIVARANX AI Assistant. How can I assist you with government services today?",
                "Hello! Welcome to NIVARANX. What service do you need help with?",
                "Hi there! I'm your NIVARANX assistant. How can I help?"
            ],
            about: [
                "NIVARANX (National Initiative for Virtual Assistance and Resolution Across Nations Xperience) is a unified platform for all government services in India. Our mission is to simplify access to essential services, ensuring 'Bharosa, Seva, Safalta'. We were established on 19 July 2025.",
                "We are a one-stop solution for citizens to access various government services digitally with ease and convenience. Our platform aims to make governance transparent and accessible. We officially launched on July 19, 2025.",
                "NIVARANX was created to bridge the gap between citizens and government services through technology and innovation, promoting digital inclusion across the nation. Our journey began on 19th July 2025."
            ],
            founder: [
                "NIVARANX was founded by Rishu Raj Upadhyay, a visionary entrepreneur from Bihar. He is also the Founder & CEO of UPADHYAYG. His vision is to make government services accessible to all Indians.",
                "Our founder, Rishu Raj Upadhyay, established NIVARANX with the core belief that every citizen should have easy and reliable access to government services.",
                "The platform is an initiative by UPADHYAYG, led by Rishu Raj Upadhyay, dedicated to simplifying public services."
            ],
            services: [
                "We offer a wide range of government services across 14 categories: National, State, Tax & Finance, Banking, Insurance, Utility, Booking, Healthcare, Education, Employment, Legal, Design, IT Services, Startup, Smart, Agriculture, Transport, and Housing. Each category contains multiple specific services.",
                "You can apply for services like Passport, Aadhaar Update, Voter ID, Driving License, PAN Card, Ration Card, Income Tax Filing, GST Registration, various loans and insurance schemes, electricity/water bill payments, train/bus/flight bookings, doctor appointments, scholarships, job cards, legal aid, company registration, and many more. Our goal is to cover all essential government services.",
                "For example, under 'National' services, you can find Passport and Aadhaar Update. Under 'Tax & Finance', we assist with Income Tax Filing and GST Registration. Just tell me which service you are interested in, and I can provide more details."
            ],
            benefits: [
                "Using NIVARANX offers numerous benefits: it's a single, unified platform for all services, ensuring convenience. We provide secure document uploads and real-time application tracking.",
                "You will experience significant time savings, reduced paperwork, and a transparent fee structure. You'll also receive timely status updates for all your applications. Our platform is designed to be user-friendly and accessible 24/7.",
                "Key advantages include 24/7 access to services from anywhere, a user-friendly mobile-first interface, and simplified processes for even complex government procedures. Our goal is 'Bharosa, Seva, Safalta' - Trust, Service, Success."
            ],
            contact: [
                "Our main office is located at UPADHYAYG, Nabinagar, Aurangabad, Bihar, India - 824302. You can find us on Google Maps via this link: https://maps.app.goo.gl/ngqqsuqoQ2GfWuvBA. You can also call us at +91 8603980072 or email us at info.upadhyayg@gmail.com. We are also available on WhatsApp at the same number.",
                "For any support or inquiries, feel free to contact us via phone, email, or WhatsApp. Our team is ready to assist you.",
                "For immediate assistance, please call our helpline at +91 8603980072. For general inquiries, you can email info.upadhyayg@gmail.com or send a message on WhatsApp."
            ],
            payment: [
                "We accept all major payment methods including Credit/Debit cards, UPI, Net Banking, and popular digital wallets. Our payment gateway is secure and reliable. All transactions are processed through RBI-approved gateways.",
                "Payments can be made securely through our platform. We ensure your transactions are safe and protected. You will receive a digital receipt for every successful transaction.",
                "You can easily pay for any service fees using various online payment options available on our portal. We prioritize your financial security during all payment processes."
            ],
            documents: [
                "Common documents typically required for most services include Aadhaar Card, PAN Card, Address Proof (like utility bills, ration card), and recent Passport-sized Photos. However, specific requirements vary by service.",
                "For example, for a Passport application, you'll need Aadhaar, PAN, Address Proof, and Photo. For an Aadhaar Update, you'll need your Existing Aadhaar and a Proof of Identity/Address. Each service's page lists its specific 'Zaroori Dastavez' (Required Documents).",
                "We also have a secure document upload feature where you can submit your documents. Our upcoming OCR feature will further simplify this by auto-extracting information from your uploaded documents for faster form filling."
            ],
            help: [
                "I can guide you through service applications, explain document requirements, assist with payment processes, and provide information about the portal. Just type your question!",
                "How can I assist you today? I can explain any service, help you navigate the application forms, provide details on fees, or answer any specific questions you have about the NIVARANX portal.",
                "Let me know what you need help with – whether it's about a specific service, technical support, or general information about NIVARANX. You can also check our 'Help & Support' section for FAQs, tutorials, and contact options."
            ],
            ocr_info: [
                "Our OCR (Optical Character Recognition) system is coming soon! It will allow you to upload images of your documents, and the system will automatically extract relevant text to pre-fill your application forms, making the process much faster and easier.",
                "The OCR feature is under development and will be integrated to enhance your document submission experience. Currently, you can upload documents, and the auto-fill feature will be available with the OCR update.",
                "Once implemented, our OCR system will significantly reduce manual data entry for your government service applications, saving you time and effort."
            ],
            updates_info: [
                "The 'Updates' section provides the latest news and announcements regarding government schemes, policy changes, and new services available on NIVARANX. It's updated regularly to keep you informed.",
                "You can find information about new installments of schemes like PM-Kisan, updates on national education policy, digital ID drives, and new features on our portal in the Updates section.",
                "Stay informed about all important government notifications and NIVARANX platform enhancements by checking the 'Updates' section frequently."
            ],
            profile_info: [
                "Your 'Profile' section is your personalized dashboard. Here, you can view your personal information, track your recent activities, manage your uploaded documents, and access settings like account preferences, security, and language.",
                "In the profile, you can see your membership details, the number of documents you've uploaded, and a timeline of your interactions with the portal. It's designed to give you a complete overview of your NIVARANX journey.",
                "The 'Profile' section allows you to manage your digital identity on NIVARANX, ensuring your data is organized and accessible. You can also log out securely from this section."
            ],
            home_info: [
                "The 'Home' section is your starting point on NIVARANX. It features a hero card with a search bar to quickly find any service you need. You can browse services by category or search directly.",
                "From the home screen, you can access all major service categories like National, State, Tax & Finance, and more. It's designed for quick and easy navigation to any government service.",
                "The home page also highlights key initiatives and provides a seamless entry point to explore all the services NIVARANX offers."
            ],
            discover_info: [
                "The 'Discover' section provides insights into NIVARANX, including our mission, vision, and values. You can learn about our founder, Rishu Raj Upadhyay, and find our contact details and office location.",
                "This section is where you can understand the 'why' behind NIVARANX and our commitment to making government services accessible. It includes information about our initiative by UPADHYAYG.",
                "Explore the 'Discover' section to get a deeper understanding of our organization, our core principles, and how to reach out to us for support or collaboration."
            ],
            default: [
                "I'm sorry, I didn't understand that. Could you please rephrase your question or ask about a specific service?",
                "I'm still learning and improving. Could you try asking that in a different way or choose from common topics like 'services', 'benefits', 'contact', 'updates', 'profile', 'home', or 'discover'?",
                "I'm not sure how to respond to that. Perhaps you could ask me about 'NIVARANX', 'founder', 'documents', or any specific service name?"
            ]
        };

        // --- App Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            populateServiceCards();
            startIntroSequence();
            setupModalContent();
            checkLoginState();
            setupChatbot();
            
            // Add event listener for search input
            document.getElementById('serviceSearchInput').addEventListener('input', filterServices);

            // Create hidden file input for document upload
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.id = 'fileInput';
            fileInput.accept = 'image/*,application/pdf'; // Accept images and PDFs
            fileInput.style.display = 'none';
            fileInput.onchange = handleFileUpload;
            document.body.appendChild(fileInput);

            // Create hidden file input for payment screenshot upload
            const paymentScreenshotInput = document.createElement('input');
            paymentScreenshotInput.type = 'file';
            paymentScreenshotInput.id = 'paymentScreenshotInput';
            paymentScreenshotInput.accept = 'image/*'; // Accept only images for screenshots
            paymentScreenshotInput.style.display = 'none';
            paymentScreenshotInput.onchange = handlePaymentScreenshotUpload;
            document.body.appendChild(paymentScreenshotInput);
        });

        function startIntroSequence() {
            const splashScreen = document.getElementById('splash-screen');
            const logoIntro = document.getElementById('logo-intro');
            const introSlides = document.getElementById('intro-slides');
            const fingerprintScannerEl = document.getElementById('fingerprint-scanner');
            
            setTimeout(() => {
                logoIntro.classList.remove('visible');
                introSlides.classList.add('visible');
                startSlideshow();
            }, 2500);

            function startSlideshow() {
                const slides = introSlides.querySelectorAll('.slide'); 
                let currentSlide = 0;
                
                const slideInterval = setInterval(() => {
                    slides[currentSlide].classList.remove('active');
                    currentSlide = (currentSlide + 1) % slides.length;
                    slides[currentSlide].classList.add('active');
                }, 2000);
                
                setTimeout(() => {
                    clearInterval(slideInterval);
                    introSlides.classList.remove('visible');
                    fingerprintScannerEl.classList.add('visible');
                }, 6000);
            }

            fingerprintScannerEl.addEventListener('click', () => {
                fingerprintScannerEl.classList.add('scanning');
                setTimeout(() => {
                    fingerprintScannerEl.classList.add('success');
                }, 1500);
                setTimeout(() => {
                    splashScreen.style.opacity = '0';
                    splashScreen.addEventListener('transitionend', () => splashScreen.style.display = 'none');
                    if(isLoggedIn) {
                        showMainApp();
                    } else {
                        document.getElementById('loginModal').classList.add('active');
                    }
                }, 2000);
            }, { once: true });
        }

        function showMainApp() {
            document.querySelector('.app-header').classList.add('visible');
            document.querySelector('.app-container').classList.add('visible');
            document.querySelector('.bottom-nav').classList.add('visible');
        }

        function populateServiceCards(filterText = '') {
            const grid = document.getElementById('servicesGrid');
            grid.innerHTML = '';
            const noServicesFound = document.getElementById('noServicesFound');
            const servicesSectionTitle = document.getElementById('servicesSectionTitle');
            let foundServices = false;

            if (filterText === '') {
                // Show categories if no filter
                servicesSectionTitle.textContent = 'All Services';
                for (const [key, data] of Object.entries(serviceData)) {
                    const card = document.createElement('div');
                    card.className = 'service-card';
                    card.dataset.category = key;
                    card.innerHTML = `<div class="service-icon"><i class="fas ${data.icon}"></i></div><div class="service-name">${data.name}</div>`;
                    card.onclick = () => openServiceModal(key);
                    grid.appendChild(card);
                    foundServices = true;
                }
            } else {
                // Show individual services if filter is active
                servicesSectionTitle.textContent = 'Matching Services';
                let allMatchingServices = [];
                for (const [key, data] of Object.entries(serviceData)) {
                    const matching = data.services.filter(service => 
                        service.name.toLowerCase().includes(filterText.toLowerCase()) ||
                        data.name.toLowerCase().includes(filterText.toLowerCase()) // Also search by category name
                    );
                    matching.forEach(service => {
                        allMatchingServices.push({ ...service, categoryKey: key, categoryName: data.name });
                    });
                }

                if (allMatchingServices.length > 0) {
                    allMatchingServices.forEach(service => {
                        const card = document.createElement('div');
                        card.className = 'service-card';
                        card.dataset.category = service.categoryKey;
                        card.innerHTML = `<div class="service-icon"><i class="fas ${service.icon}"></i></div><div class="service-name">${service.name}</div>`;
                        card.onclick = () => openProcessModal(service.categoryKey, service.name);
                        grid.appendChild(card);
                        foundServices = true;
                    });
                }
            }

            if (!foundServices) {
                noServicesFound.style.display = 'block';
            } else {
                noServicesFound.style.display = 'none';
            }
        }

        function filterServices(event) {
            const filterText = event.target.value;
            populateServiceCards(filterText);
        }
        
        // --- Modal Content & Management ---
        function setupModalContent() {
            document.getElementById('loginModalContent').innerHTML = `
                <div class="login-header">
                    <!-- Replaced text logo with image logo -->
                    <img src="https://img1.wsimg.com/isteam/ip/e8186a9b-5cfd-4d09-9ac8-87df4de0cc9e/NivaranX%E2%84%A2.png" alt="NIVARANX Logo" class="login-logo-image">
                    <h1 class="login-title">NIVARANX</h1>
                    <div class="login-subtitle">Bharosa. Seva. Safalta.</div>
                </div>
                <div id="auth-container"></div>`;
            
            document.getElementById('discoverModalContent').innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-info-circle"></i> NIVARANX के बारे में</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div class="discover-card founder-profile">
                    <img src="https://img1.wsimg.com/isteam/ip/e8186a9b-5cfd-4d09-9ac8-87df4de0cc9e/file_00000000a1bc61f7baf84e5d1ec8a904.png/:/cr=t:0%25,l:0%25,w:100%25,h:100%25/rs=w:1024,cg:true" alt="संस्थापक और सीईओ ऋषु राज उपाध्याय">
                    <div class="founder-info">
                        <h4>ऋषु राज उपाध्याय</h4>
                        <p>संस्थापक और सीईओ, UPADHYAYG</p>
                    </div>
                </div>
                <div class="discover-card">
                    <p class="founder-bio">"डिजिटल इंडिया के सपने को साकार करने के लिए, मैंने NIVARANX की स्थापना की, ताकि हर नागरिक तक तकनीक पहुंचे और शासन पारदर्शी, सुलभ और तत्काल बने।"</p>
                </div>
                <div class="discover-card">
                    <h3><i class="fas fa-calendar-alt"></i> स्थापना</h3>
                    <p>NIVARANX की स्थापना <strong>19 जुलाई 2025</strong> को हुई थी।</p>
                </div>
                <div class="discover-card">
                    <h3><i class="fas fa-bullseye"></i> हमारा मिशन</h3>
                    <p>हर भारतीय को एक एकीकृत मंच प्रदान करके सशक्त बनाना, जिससे 'भरोसा, सेवा, सफलता' का भविष्य बनाया जा सके।</p>
                </div>
                <div class="discover-card">
                    <h3><i class="fas fa-binoculars"></i> हमारा विजन</h3>
                    <p>भारत का सबसे विश्वसनीय डिजिटल प्लेटफॉर्म बनना, जो हर नागरिक के लिए आवश्यक सेवाओं तक पहुंच को सरल बनाता है।</p>
                </div>
                <div class="discover-card">
                    <h3><i class="fas fa-lightbulb"></i> हमारे मूल्य</h3>
                    <ul>
                        <li><strong>पारदर्शिता:</strong> सभी प्रक्रियाओं में स्पष्टता और ईमानदारी।</li>
                        <li><strong>सुलभता:</strong> हर किसी के लिए सेवाओं तक आसान पहुंच।</li>
                        <li><strong>नवाचार:</strong> नागरिकों के लिए बेहतर समाधान बनाने के लिए प्रौद्योगिकी का लाभ उठाना।</li>
                        <li><strong>विश्वसनीयता:</strong> विश्वसनीय और सुरक्षित सेवाएँ प्रदान करना।</li>
                        <li><strong>नागरिक-केंद्रित:</strong> नागरिकों की जरूरतों को प्राथमिकता देना।</li>
                    </ul>
                </div>
                <div class="discover-card">
                    <h3><i class="fas fa-building"></i> मुख्य कार्यालय</h3>
                    <p><strong>UPADHYAYG</strong><br>नवीनगर, औरंगाबाद,<br>बिहार, भारत - 824302</p>
                    <div class="map-placeholder">
                        <a href="https://maps.app.goo.gl/ngqqsuqoQ2GfWuvBA" target="_blank" style="color: white; text-decoration: none; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; width: 100%;">
                            <i class="fas fa-map-marker-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            Google मानचित्र पर देखें
                        </a>
                    </div>
                    <p style="margin-top:15px;"><strong>फ़ोन:</strong> +91 8603980072<br><strong>ईमेल:</strong> info.upadhyayg@gmail.com</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>`;
            
            document.getElementById('updatesModalContent').innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-newspaper"></i> नवीनतम अपडेट</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div class="update-list">
                    ${updatesData.map(update => `
                        <div class="update-card">
                            <i class="fas ${update.icon} update-icon"></i>
                            <div class="update-content">
                                <h4>${update.title}</h4>
                                <p>${update.content}</p>
                                <div class="update-date">${update.date}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>`;
        }

        function renderProfileModal() {
            if (!currentUser) {
                showToast('प्रोफाइल देखने के लिए कृपया लॉगिन करें।', 'error');
                document.getElementById('loginModal').classList.add('active'); // Show login modal if not logged in
                return;
            }
            const initials = currentUser.name.split(' ').map(n => n[0]).join('');
            
            // Generate recent activity timeline
            let activityHtml = '';
            if (userActivity.length > 0) {
                activityHtml = `
                    <div class="form-section">
                        <h3 class="form-section-title"><i class="fas fa-history"></i> हाल की गतिविधि</h3>
                        <div class="timeline">
                            ${userActivity.slice(0, 5).map(activity => `
                                <div class="timeline-item">
                                    <div class="timeline-date">${new Date(activity.timestamp).toLocaleString('hi-IN')}</div>
                                    <div class="timeline-content">
                                        <i class="fas ${activity.icon || 'fa-check-circle'}"></i>
                                        ${activity.description}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>`;
            }
            
            // Generate document upload status
            let docsHtml = '';
            if (userDocuments.length > 0) {
                docsHtml = `
                    <div class="form-section">
                        <h3 class="form-section-title"><i class="fas fa-file-upload"></i> दस्तावेज़ स्थिति</h3>
                        ${userDocuments.slice(0, 3).map(doc => `
                            <div class="upload-status ${doc.status || 'success'}">
                                <div class="upload-status-icon">
                                    <i class="fas ${doc.status === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle'}"></i>
                                </div>
                                <div class="upload-status-info">
                                    <div class="upload-status-name">${doc.type}</div>
                                    <div class="upload-status-desc">पर अपलोड किया गया ${new Date(doc.timestamp).toLocaleDateString('hi-IN')}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>`;
            }
            
            document.getElementById('profileModalContent').innerHTML = `
                <div class="modal-header" style="border:none; margin-bottom:0;">
                    <h2 class="modal-title"><i class="fas fa-user-circle"></i> मेरी प्रोफाइल</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div class="profile-header">
                    <div class="profile-avatar">${initials}</div>
                    <div class="profile-info">
                        <h3>${currentUser.name}</h3>
                        <p>${currentUser.email}</p>
                    </div>
                </div>
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-value">${userDocuments.length}</div>
                        <div class="stat-label">दस्तावेज़</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${new Date(currentUser.joined).getFullYear()}</div>
                        <div class="stat-label">सदस्यता वर्ष</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">प्रीमियम</div>
                        <div class="stat-label">योजना</div>
                    </div>
                </div>
                
                ${activityHtml}
                ${docsHtml}
                
                <div class="profile-menu">
                    <div class="profile-menu-item" onclick="viewDocumentLibrary()">
                        <i class="fas fa-file-invoice"></i>
                        <span>मेरे दस्तावेज़</span>
                    </div>
                    <div class="profile-menu-item" onclick="viewAccountSettings()">
                        <i class="fas fa-cog"></i>
                        <span>खाता सेटिंग्स</span>
                    </div>
                    <div class="profile-menu-item" onclick="viewTransactionHistory()">
                        <i class="fas fa-exchange-alt"></i>
                        <span>लेन-देन का इतिहास</span>
                    </div>
                    <div class="profile-menu-item" onclick="viewSecuritySettings()">
                        <i class="fas fa-user-shield"></i>
                        <span>सुरक्षा और पासवर्ड</span>
                    </div>
                    <div class="profile-menu-item" onclick="viewLanguageSettings()">
                        <i class="fas fa-language"></i>
                        <span>भाषा सेटिंग्स</span>
                    </div>
                    <div class="profile-menu-item" onclick="viewHelpSupport()">
                        <i class="fas fa-question-circle"></i>
                        <span>सहायता और समर्थन</span>
                    </div>
                </div>
                <button class="btn logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> लॉगआउट करें
                </button>
                <div class="last-login">अंतिम लॉगिन: ${appTime.toLocaleString('hi-IN')} से ${appLocation}</div>`;
        }

        function viewAccountSettings() {
            const modalContent = document.getElementById('serviceModalContent');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-cog"></i> खाता सेटिंग्स</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div class="form-section">
                    <h3 class="form-section-title">व्यक्तिगत जानकारी</h3>
                    <div class="form-group">
                        <label class="form-label">पूरा नाम</label>
                        <input type="text" class="form-control" value="${currentUser.name}" disabled>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ईमेल पता</label>
                        <input type="email" class="form-control" value="${currentUser.email}" disabled>
                    </div>
                    <div class="form-group">
                        <label class="form-label">मोबाइल नंबर</label>
                        <input type="tel" class="form-control" value="${currentUser.mobile}" disabled>
                    </div>
                </div>
                <div class="form-section">
                    <h3 class="form-section-title">अधिसूचना प्राथमिकताएं</h3>
                    <div class="form-group">
                        <label><input type="checkbox" checked disabled> ईमेल सूचनाएं</label>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" checked disabled> एसएमएस अलर्ट</label>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" checked disabled> ऐप सूचनाएं</label>
                    </div>
                </div>
                <button class="btn btn-primary" style="width:100%; margin-top:20px;" disabled>
                    <i class="fas fa-save"></i> परिवर्तन सहेजें (सिमुलेटेड)
                </button>`;
            
            closeAllModals();
            document.getElementById('serviceModal').classList.add('active');
        }

        function viewTransactionHistory() {
            const modalContent = document.getElementById('serviceModalContent');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-exchange-alt"></i> लेन-देन का इतिहास</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div style="text-align:center; padding:20px;">
                    <i class="fas fa-receipt" style="font-size:3rem; color:var(--accent); margin-bottom:15px;"></i>
                    <p>आपका लेन-देन का इतिहास यहां दिखाई देगा</p>
                    <p style="opacity:0.7; font-size:0.9rem;">आपने अभी तक कोई लेन-देन नहीं किया है</p>
                </div>`;
            
            closeAllModals();
            document.getElementById('serviceModal').classList.add('active');
        }

        function viewDocumentLibrary() {
            const modalContent = document.getElementById('serviceModalContent');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-file-alt"></i> मेरे दस्तावेज़</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div id="documentLibrary">
                    ${userDocuments.length === 0 ? 
                        '<p style="text-align:center; opacity:0.7; padding:20px;">अभी तक कोई दस्तावेज़ अपलोड नहीं किया गया है</p>' : 
                        userDocuments.map(doc => `
                            <div class="document-card" onclick="viewDocument('${doc.type}')">
                                <img src="${doc.image}" alt="${doc.type}">
                                <div class="document-info">
                                    <h4>${doc.type}</h4>
                                    <small>${new Date(doc.timestamp).toLocaleString('hi-IN')}</small>
                                </div>
                                <div class="document-actions">
                                    <button class="btn btn-outline" onclick="viewDocument('${doc.type}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline" onclick="event.stopPropagation(); deleteDocument('${doc.type}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                </div>
                <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="initDocumentScanner()">
                    <i class="fas fa-plus"></i> नया दस्तावेज़ जोड़ें
                </button>`;
            
            closeAllModals();
            document.getElementById('serviceModal').classList.add('active');
        }

        function viewSecuritySettings() {
            const modalContent = document.getElementById('serviceModalContent');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-user-shield"></i> सुरक्षा सेटिंग्स</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div class="form-section">
                    <h3 class="form-section-title">पासवर्ड बदलें</h3>
                    <div class="form-group">
                        <label class="form-label">वर्तमान पासवर्ड</label>
                        <input type="password" class="form-control" placeholder="वर्तमान पासवर्ड दर्ज करें" disabled>
                    </div>
                    <div class="form-group">
                        <label class="form-label">नया पासवर्ड</label>
                        <input type="password" class="form-control" placeholder="नया पासवर्ड दर्ज करें" disabled>
                    </div>
                    <div class="form-group">
                        <label class="form-label">नया पासवर्ड पुष्टि करें</label>
                        <input type="password" class="form-control" placeholder="नया पासवर्ड पुष्टि करें" disabled>
                    </div>
                </div>
                <div class="form-section">
                    <h3 class="form-section-title">दो-कारक प्रमाणीकरण</h3>
                    <div class="form-group">
                        <label><input type="checkbox" disabled> एसएमएस सत्यापन सक्षम करें</label>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" disabled> ईमेल सत्यापन सक्षम करें</label>
                    </div>
                </div>
                <button class="btn btn-primary" style="width:100%; margin-top:20px;" disabled>
                    <i class="fas fa-save"></i> सुरक्षा सेटिंग्स अपडेट करें (सिमुलेटेड)
                </button>`;
            
            closeAllModals();
            document.getElementById('serviceModal').classList.add('active');
        }

        function viewLanguageSettings() {
            const modalContent = document.getElementById('serviceModalContent');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-language"></i> भाषा सेटिंग्स</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div class="form-section">
                    <h3 class="form-section-title">पसंदीदा भाषा</h3>
                    <div class="form-group">
                        <label><input type="radio" name="language" checked disabled> English</label>
                    </div>
                    <div class="form-group">
                        <label><input type="radio" name="language" disabled> Hindi</label>
                    </div>
                    <div class="form-group">
                        <label><input type="radio" name="language" disabled> क्षेत्रीय भाषा</label>
                    </div>
                </div>
                <button class="btn btn-primary" style="width:100%; margin-top:20px;" disabled>
                    <i class="fas fa-save"></i> भाषा प्राथमिकता सहेजें (सिमुलेटेड)
                </button>`;
            
            closeAllModals();
            document.getElementById('serviceModal').classList.add('active');
        }

        function viewHelpSupport() {
            const modalContent = document.getElementById('serviceModalContent');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-question-circle"></i> सहायता और समर्थन</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div class="form-section">
                    <h3 class="form-section-title">अक्सर पूछे जाने वाले प्रश्न</h3>
                    <div class="service-item" onclick="showChatbot()">
                        <i class="fas fa-robot"></i>
                        <span>हमारे AI सहायक से चैट करें</span>
                    </div>
                    <div class="service-item">
                        <i class="fas fa-phone-alt"></i>
                        <span>कॉल समर्थन: +91 8603980072</span>
                    </div>
                    <div class="service-item">
                        <i class="fas fa-envelope"></i>
                        <span>ईमेल: info.upadhyayg@gmail.com</span>
                    </div>
                    <div class="service-item">
                        <i class="fab fa-whatsapp"></i>
                        <span>व्हाट्सएप: +91 8603980072</span>
                    </div>
                </div>
                <div class="form-section">
                    <h3 class="form-section-title">ट्यूटोरियल और गाइड</h3>
                    <div class="service-item">
                        <i class="fas fa-play-circle"></i>
                        <span>सेवाओं के लिए आवेदन कैसे करें</span>
                    </div>
                    <div class="service-item">
                        <i class="fas fa-file-pdf"></i>
                        <span>उपयोगकर्ता मैनुअल डाउनलोड करें</span>
                    </div>
                </div>`;
            
            closeAllModals();
            document.getElementById('serviceModal').classList.add('active');
        }

        function openServiceModal(categoryKey) {
            const category = serviceData[categoryKey];
            const modalContent = document.getElementById('serviceModalContent');
            
            let servicesHtml = category.services.map(service => `
                <div class="service-item" onclick="openProcessModal('${categoryKey}', '${service.name}')">
                    <i class="fas ${service.icon}"></i>
                    <span>${service.name}</span>
                </div>
            `).join('');
            
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas ${category.icon}"></i> ${category.name} सेवाएँ</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div class="service-list">${servicesHtml}</div>`;
            
            document.getElementById('serviceModal').classList.add('active');
        }

        function openProcessModal(categoryKey, serviceName) {
            const service = serviceData[categoryKey].services.find(s => s.name === serviceName);
            service.categoryKey = categoryKey;
            currentServiceForForm = service;
            
            // Add to user activity
            userActivity.unshift({
                description: `सेवा विवरण देखे: ${serviceName}`,
                timestamp: new Date().toISOString(),
                icon: service.icon
            });
            localStorage.setItem('userActivity', JSON.stringify(userActivity));
            
            const modalContent = document.getElementById('processModalContent');
            let docsHtml = service.docs.map(doc => `
                <div class="document-item">
                    <i class="fas fa-check-circle"></i>
                    <span>${doc}</span>
                </div>
            `).join('');
            
            let feesHtml = `
                <tr>
                    <td>सरकारी शुल्क:</td>
                    <td>${typeof service.fees.official === 'number' ? '₹' + service.fees.official : service.fees.official}</td>
                </tr>
                <tr>
                    <td>प्लेटफ़ॉर्म शुल्क:</td>
                    <td>₹${service.fees.platform}</td>
                </tr>
                <tr style="border:none;">
                    <td><strong>कुल शुल्क:</strong></td>
                    <td class="highlight">${typeof service.fees.total === 'number' ? '₹' + service.fees.total : '₹' + service.fees.total}</td>
                </tr>`;
            
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas ${service.icon}"></i> ${service.name}</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div class="process-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">आवेदन भरें</div>
                        <div class="step-desc">ज़रूरी जानकारी फॉर्म में भरें।</div>
                    </div>
                </div>
                <div class="process-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">दस्तावेज़ अपलोड करें</div>
                        <div class="step-desc">सभी ज़रूरी दस्तावेज़ अपलोड करें।</div>
                    </div>
                </div>
                <div class="process-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">शुल्क भुगतान करें</div>
                        <div class="step-desc">सुरक्षित गेटवे से भुगतान करें।</div>
                    </div>
                </div>
                <div class="documents-section" style="margin-top:20px;">
                    <h3 class="section-title">ज़रूरी दस्तावेज़</h3>
                    ${docsHtml}
                </div>
                <div class="fees-section">
                    <h3 class="section-title">शुल्क विवरण</h3>
                    <table class="fees-table">${feesHtml}</table>
                </div>
                <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="openFormModal()">
                    <i class="fas fa-play"></i> आवेदन शुरू करें
                </button>`;
            
            closeAllModals();
            document.getElementById('processModal').classList.add('active');
        }

        function openFormModal() {
            const service = currentServiceForForm;
            if (!service) return;
            
            // Generate document upload section
            let docsHtml = service.docs.map(doc => `
                <div class="upload-item">
                    <span>${doc}</span>
                    <button class="upload-btn" onclick="initDocumentScanner('${doc}')">
                        <i class="fas fa-upload"></i> अपलोड करें
                    </button>
                </div>
            `).join('');
            
            // Generate dynamic form fields
            let formSectionsHtml = '';
            if (service.formFields && service.formFields.length > 0) {
                service.formFields.forEach(section => {
                    formSectionsHtml += `
                        <div class="form-section">
                            <h3 class="form-section-title">${section.title}</h3>`;
                    section.fields.forEach(field => {
                        formSectionsHtml += `<div class="form-group">`;
                        if (field.label) {
                            formSectionsHtml += `<label class="form-label">${field.label}</label>`;
                        }
                        if (field.type === 'text' || field.type === 'email' || field.type === 'tel' || field.type === 'number' || field.type === 'date') {
                            formSectionsHtml += `<input type="${field.type}" name="${field.name}" class="form-control" placeholder="${field.placeholder || ''}" ${field.required ? 'required' : ''} value="${field.value || ''}" ${field.readonly ? 'readonly' : ''}>`;
                        } else if (field.type === 'textarea') {
                            formSectionsHtml += `<textarea name="${field.name}" class="form-control" placeholder="${field.placeholder || ''}" ${field.required ? 'required' : ''}>${field.value || ''}</textarea>`;
                        } else if (field.type === 'select') {
                            formSectionsHtml += `<select name="${field.name}" class="form-control" ${field.required ? 'required' : ''}>`;
                            field.options.forEach(option => {
                                formSectionsHtml += `<option value="${option}">${option}</option>`;
                            });
                            formSectionsHtml += `</select>`;
                        } else if (field.type === 'radio') {
                            formSectionsHtml += `<div class="radio-group">`;
                            field.options.forEach(option => {
                                formSectionsHtml += `<label><input type="radio" name="${field.name}" value="${option}" ${field.required ? 'required' : ''}> ${option}</label>`;
                            });
                            formSectionsHtml += `</div>`;
                        } else if (field.type === 'checkbox') {
                            formSectionsHtml += `<div class="checkbox-group">`;
                            field.options.forEach(option => {
                                formSectionsHtml += `<label><input type="checkbox" name="${field.name}" value="${option}" ${field.required ? 'required' : ''}> ${option}</label>`;
                            });
                            formSectionsHtml += `</div>`;
                        }
                        formSectionsHtml += `</div>`;
                    });
                    formSectionsHtml += `</div>`;
                });
            } else {
                // Fallback to generic form if no specific formFields are defined
                formSectionsHtml = `
                    <div class="form-section">
                        <h3 class="form-section-title">धारा 1: व्यक्तिगत विवरण</h3>
                        <div class="form-group">
                            <label class="form-label">पूरा नाम (दस्तावेजों के अनुसार)</label>
                            <div class="radio-group" style="margin-bottom:10px;">
                                <label><input type="radio" name="title" value="Shri"> श्री</label>
                                <label><input type="radio" name="title" value="Smt"> श्रीमती</label>
                                <label><input type="radio" name="title" value="Kum"> कुमारी</label>
                            </div>
                            <div class="form-row">
                                <input type="text" name="lastName" class="form-control" placeholder="उपनाम" required>
                                <input type="text" name="firstName" class="form-control" placeholder="पहला नाम" required>
                            </div>
                            <input type="text" name="middleName" class="form-control" placeholder="मध्य नाम (यदि कोई हो)" style="margin-top:10px;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">लिंग और जन्म तिथि</label>
                            <div class="radio-group" style="margin-bottom:10px;">
                                <label><input type="radio" name="gender" value="Male" required> पुरुष</label>
                                <label><input type="radio" name="gender" value="Female"> महिला</label>
                                <label><input type="radio" name="gender" value="Other"> अन्य</label>
                            </div>
                            <input type="date" name="dob" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">माता-पिता का विवरण</label>
                            <input type="text" name="fatherName" class="form-control" placeholder="पिता का पूरा नाम" required style="margin-bottom:10px;">
                            <input type="text" name="motherName" class="form-control" placeholder="माता का पूरा नाम" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">वैवाहिक स्थिति</label>
                            <div class="radio-group">
                                <label><input type="radio" name="maritalStatus" value="Single"> अविवाहित</label>
                                <label><input type="radio" name="maritalStatus" value="Married"> विवाहित</label>
                                <label><input type="radio" name="maritalStatus" value="Divorced"> तलाकशुदा</label>
                                <label><input type="radio" name="maritalStatus" value="Widowed"> विधवा/विधुर</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="form-section-title">धारा 2: पता विवरण</h3>
                        <div class="form-group">
                            <label class="form-label">वर्तमान पता</label>
                            <input type="text" name="address1" class="form-control" placeholder="मकान/दरवाजा नंबर, गली/क्षेत्र" required style="margin-bottom:10px;">
                            <input type="text" name="address2" class="form-control" placeholder="गांव/कस्बा/शहर" required style="margin-bottom:10px;">
                            <div class="form-row">
                                <input type="text" name="district" class="form-control" placeholder="जिला" required>
                                <input type="text" name="state" class="form-control" placeholder="राज्य" required>
                            </div>
                            <div class="form-row" style="margin-top:10px;">
                                <input type="text" name="pincode" class="form-control" placeholder="पिनकोड" required>
                                <input type="text" name="country" class="form-control" value="भारत" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">स्थायी पता (यदि भिन्न हो)</label>
                            <label><input type="checkbox" id="sameAsCurrent"> वर्तमान पते के समान</label>
                            <div id="permanentAddressFields">
                                <input type="text" name="permAddress1" class="form-control" placeholder="मकान/दरवाजा नंबर, गली/क्षेत्र" style="margin-top:10px; margin-bottom:10px;">
                                <input type="text" name="permAddress2" class="form-control" placeholder="गांव/कस्बा/शहर" style="margin-bottom:10px;">
                                <div class="form-row">
                                    <input type="text" name="permDistrict" class="form-control" placeholder="जिला">
                                    <input type="text" name="permState" class="form-control" placeholder="राज्य">
                                </div>
                                <div class="form-row" style="margin-top:10px;">
                                    <input type="text" name="permPincode" class="form-control" placeholder="पिनकोड">
                                    <input type="text" name="permCountry" class="form-control" value="भारत" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="form-section-title">धारा 3: संपर्क और पहचान</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">मोबाइल नंबर</label>
                                <input type="tel" name="mobile" class="form-control" value="${currentUser?.mobile || ''}" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ईमेल</label>
                                <input type="email" name="email" class="form-control" value="${currentUser?.email || ''}" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">आधार नंबर</label>
                                <input type="text" name="aadhaar" class="form-control" placeholder="12-अंकीय आधार">
                            </div>
                            <div class="form-group">
                                <label class="form-label">पैन नंबर</label>
                                <input type="text" name="pan" class="form-control" placeholder="10-अंकीय पैन">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="form-section-title">धारा 4: अतिरिक्त जानकारी</h3>
                        <div class="form-group">
                            <label class="form-label">शैक्षणिक योग्यता</label>
                            <select name="education" class="form-control">
                                <option value="">चुनें</option>
                                <option value="Below 10th">10वीं से नीचे</option>
                                <option value="10th Pass">10वीं पास</option>
                                <option value="12th Pass">12वीं पास</option>
                                <option value="Graduate">स्नातक</option>
                                <option value="Post Graduate">स्नातकोत्तर</option>
                                <option value="Doctorate">डॉक्टरेट</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">व्यवसाय</label>
                            <input type="text" name="occupation" class="form-control" placeholder="आपका पेशा">
                        </div>
                        <div class="form-group">
                            <label class="form-label">वार्षिक आय (₹)</label>
                            <input type="number" name="income" class="form-control" placeholder="अनुमानित वार्षिक आय">
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="form-section-title">धारा 5: घोषणा</h3>
                        <div class="form-group">
                            <label><input type="checkbox" required> मैं घोषणा करता/करती हूं कि प्रदान की गई सभी जानकारी मेरे सर्वोत्तम ज्ञान के अनुसार सही है।</label>
                        </div>
                        <div class="form-group">
                            <label class="form-label">स्थान</label>
                            <input type="text" name="place" class="form-control" placeholder="शहर/कस्बा/गांव">
                        </div>
                        <div class="form-group">
                            <label class="form-label">दिनांक</label>
                            <input type="date" name="declarationDate" class="form-control" value="${new Date().toISOString().split('T')[0]}">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="openProcessModal(currentServiceForForm.categoryKey, currentServiceForForm.name)">वापस</button>
                        <button type="submit" class="btn btn-primary" onclick="initiatePayment()">भुगतान के लिए आगे बढ़ें</button>
                    </div>
                </form>`;
            }
            
            // Add to existing form modal content
            const modalFormContent = document.getElementById('formModalContent');
            modalFormContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-file-alt"></i> आवेदन पत्र</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: var(--accent);">
                        <i class="fas fa-file-upload"></i> आवश्यक दस्तावेज़
                    </h3>
                    ${docsHtml}
                    <div id="uploadedDocumentsPreview"></div>
                </div>
                <form id="nivaranx-application-form">
                    ${formSectionsHtml}
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="openProcessModal(currentServiceForForm.categoryKey, currentServiceForForm.name)">वापस</button>
                        <button type="submit" class="btn btn-primary" onclick="initiatePayment()">भुगतान के लिए आगे बढ़ें</button>
                    </div>
                </form>
            `;

            // Add same as current address functionality if the fields exist
            const sameAsCurrentCheckbox = document.getElementById('sameAsCurrent');
            if (sameAsCurrentCheckbox) {
                sameAsCurrentCheckbox.addEventListener('change', function() {
                    const form = document.getElementById('nivaranx-application-form');
                    const permFields = document.getElementById('permanentAddressFields');
                    const permInputs = permFields.querySelectorAll('input, textarea, select');
                    if (this.checked) {
                        permFields.style.display = 'none';
                        // Copy values from current address
                        form.querySelector('[name="address1"]').value = form.querySelector('[name="address1"]').value; // Self-referencing to ensure it's not null
                        form.querySelector('[name="address2"]').value = form.querySelector('[name="address2"]').value;
                        form.querySelector('[name="district"]').value = form.querySelector('[name="district"]').value;
                        form.querySelector('[name="state"]').value = form.querySelector('[name="state"]').value;
                        form.querySelector('[name="pincode"]').value = form.querySelector('[name="pincode"]').value;

                        form.querySelector('[name="permAddress1"]').value = form.querySelector('[name="address1"]').value;
                        form.querySelector('[name="permAddress2"]').value = form.querySelector('[name="address2"]').value;
                        form.querySelector('[name="permDistrict"]').value = form.querySelector('[name="district"]').value;
                        form.querySelector('[name="permState"]').value = form.querySelector('[name="state"]').value;
                        form.querySelector('[name="permPincode"]').value = form.querySelector('[name="pincode"]').value;

                        permInputs.forEach(input => input.removeAttribute('required'));
                    } else {
                        permFields.style.display = 'block';
                        permInputs.forEach(input => input.setAttribute('required', ''));
                    }
                });
            }

            // Pre-fill user's mobile and email if logged in
            if (currentUser) {
                const form = document.getElementById('nivaranx-application-form');
                if (form.elements.mobile) form.elements.mobile.value = currentUser.mobile || '';
                if (form.elements.email) form.elements.email.value = currentUser.email || '';
            }

            renderUploadedDocuments();
            closeAllModals();
            document.getElementById('formModal').classList.add('active');
        }

        function renderUploadedDocuments() {
            const container = document.getElementById('uploadedDocumentsPreview');
            if (!container) return;
            
            if (userDocuments.length === 0) {
                container.innerHTML = '<p style="opacity:0.7; text-align:center;">अभी तक कोई दस्तावेज़ अपलोड नहीं किया गया है</p>';
                return;
            }
            
            container.innerHTML = userDocuments.map(doc => `
                <div class="document-card" onclick="viewDocument('${doc.type}')">
                    <img src="${doc.image}" alt="${doc.type}">
                    <div class="document-info">
                        <h4>${doc.type}</h4>
                        <small>${new Date(doc.timestamp).toLocaleString('hi-IN')}</small>
                    </div>
                    <div class="document-actions">
                        <button class="btn btn-outline" onclick="viewDocument('${doc.type}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-outline" onclick="event.stopPropagation(); deleteDocument('${doc.type}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function viewDocument(docType) {
            const doc = userDocuments.find(d => d.type === docType);
            if (!doc) return;
            
            document.getElementById('fullDocumentPreview').src = doc.image;
            document.getElementById('documentPreviewModal').classList.add('active');
        }

        function closeDocumentPreview() {
            document.getElementById('documentPreviewModal').classList.remove('active');
        }

        function deleteDocument(docType) {
            // Using a custom modal for confirmation instead of alert/confirm
            const confirmDelete = () => {
                userDocuments = userDocuments.filter(d => d.type !== docType);
                localStorage.setItem('userDocuments', JSON.stringify(userDocuments));
                renderUploadedDocuments();
                showToast('दस्तावेज़ हटा दिया गया', 'success');
                
                // Add to activity
                userActivity.unshift({
                    description: `दस्तावेज़ हटा दिया गया: ${docType}`,
                    timestamp: new Date().toISOString(),
                    icon: 'fa-trash'
                });
                localStorage.setItem('userActivity', JSON.stringify(userActivity));
                closeAllModals(); // Close the confirmation modal
            };

            const showConfirmModal = (message) => {
                const modalContent = document.getElementById('serviceModalContent');
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h2 class="modal-title"><i class="fas fa-exclamation-triangle"></i> हटाना पुष्टि करें</h2>
                        <button class="close-modal" onclick="closeAllModals()">&times;</button>
                    </div>
                    <p style="text-align: center; margin-bottom: 20px;">${message}</p>
                    <div class="form-actions" style="justify-content: center;">
                        <button class="btn btn-outline" onclick="closeAllModals()">रद्द करें</button>
                        <button class="btn btn-danger" onclick="confirmDelete();">हटाएं</button>
                    </div>
                `;
                document.getElementById('serviceModal').classList.add('active');
            };
            showConfirmModal(`क्या आप निश्चित हैं कि आप इस ${docType} दस्तावेज़ को हटाना चाहते हैं?`);
        }

        // --- Document Scanner Functions (modified for no OCR) ---
        function initDocumentScanner(documentType = null) {
            currentDocumentType = documentType;
            document.getElementById('scannerVideo').style.display = 'none';
            document.getElementById('scannerCanvas').style.display = 'none';
            document.getElementById('documentPreview').innerHTML = '<p style="opacity:0.7; text-align:center;">अपने दस्तावेज़ की स्पष्ट तस्वीर लें या अपलोड करें</p>';
            document.getElementById('verificationSteps').style.display = 'block'; // Show steps initially
            document.getElementById('retryScanBtn').style.display = 'none';
            document.getElementById('useDocumentBtn').style.display = 'none';
            
            // Reset verification steps
            const steps = document.querySelectorAll('.verification-step');
            steps.forEach((step, index) => {
                step.classList.remove('completed', 'in-progress');
                if (index === 0) step.classList.add('in-progress'); // First step is in progress
            });
            document.getElementById('step1').querySelector('.verification-step-title').textContent = 'दस्तावेज़ अपलोड';
            document.getElementById('step1').querySelector('.verification-step-desc').textContent = 'आपके दस्तावेज़ को प्रसंस्करण के लिए अपलोड किया जा रहा है';
            document.getElementById('step2').querySelector('.verification-step-title').textContent = 'दस्तावेज़ प्रसंस्करण';
            document.getElementById('step2').querySelector('.verification-step-desc').textContent = 'दस्तावेज़ का सत्यापन और उपयोग के लिए तैयार करना';
            document.getElementById('step3').querySelector('.verification-step-title').textContent = 'OCR जल्द आ रहा है';
            document.getElementById('step3').querySelector('.verification-step-desc').textContent = 'ऑटो-फिल सुविधा जल्द ही उपलब्ध होगी';

            document.getElementById('takePhotoBtn').onclick = startCamera;
            document.getElementById('uploadPhotoBtn').onclick = () => document.getElementById('fileInput').click();
            document.getElementById('retryScanBtn').onclick = initDocumentScanner;
            document.getElementById('useDocumentBtn').onclick = saveDocument;
            
            document.getElementById('documentScannerModal').classList.add('active');
        }

        function startCamera() {
            const video = document.getElementById('scannerVideo');
            
            // Stop any existing stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'environment' }, 
                audio: false 
            }).then(function(s) {
                stream = s;
                video.srcObject = stream;
                video.style.display = 'block';
                document.getElementById('documentPreview').innerHTML = ''; // Clear initial text
                
                // Show capture button
                document.getElementById('takePhotoBtn').innerHTML = '<i class="fas fa-camera"></i> कैप्चर करें';
                document.getElementById('takePhotoBtn').onclick = captureDocument;
            }).catch(function(err) {
                showToast('कैमरा एक्सेस अस्वीकृत: ' + err.message, 'error');
            });
        }

        function captureDocument() {
            const video = document.getElementById('scannerVideo');
            const canvas = document.getElementById('scannerCanvas');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Stop camera
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            video.style.display = 'none';
            processImage(canvas.toDataURL('image/jpeg'));
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                processImage(event.target.result);
            };
            reader.readAsDataURL(file);
            
            // Reset file input
            e.target.value = '';
        }

        function processImage(imageData) {
            const preview = document.getElementById('documentPreview');
            const verificationSteps = document.getElementById('verificationSteps');
            
            preview.innerHTML = `<img src="${imageData}" alt="कैप्चर किया गया दस्तावेज़" style="max-height: 250px;">`;
            verificationSteps.style.display = 'block';
            document.getElementById('retryScanBtn').style.display = 'inline-block';
            document.getElementById('useDocumentBtn').style.display = 'none';
            
            // Store the image data temporarily
            currentDocumentImage = imageData;
            
            // Reset steps and start processing animation
            const steps = document.querySelectorAll('.verification-step');
            steps.forEach(step => step.classList.remove('completed', 'in-progress'));
            document.getElementById('step1').classList.add('in-progress');
            
            // Simulate processing steps
            setTimeout(() => {
                document.getElementById('step1').classList.remove('in-progress');
                document.getElementById('step1').classList.add('completed');
                document.getElementById('step2').classList.add('in-progress');
                
                setTimeout(() => {
                    document.getElementById('step2').classList.remove('in-progress');
                    document.getElementById('step2').classList.add('completed');
                    document.getElementById('step3').classList.add('in-progress'); // OCR Coming Soon
                    
                    setTimeout(() => {
                        document.getElementById('step3').classList.remove('in-progress');
                        document.getElementById('step3').classList.add('completed');
                        document.getElementById('useDocumentBtn').style.display = 'inline-block';
                        showToast('दस्तावेज़ संसाधित। OCR सुविधा जल्द ही आ रही है!', 'info');
                    }, 1000); // Simulate OCR step completion
                }, 1500); // Simulate processing step completion
            }, 1000); // Simulate upload step completion
        }

        function saveDocument() {
            if (!currentDocumentImage) return;
            
            // Add to user's document library
            const newDoc = {
                type: currentDocumentType || 'अपलोड किया गया दस्तावेज़',
                image: currentDocumentImage,
                timestamp: new Date().toISOString(),
                status: 'success'
            };
            
            userDocuments.push(newDoc);
            localStorage.setItem('userDocuments', JSON.stringify(userDocuments));
            
            // Add to activity
            userActivity.unshift({
                description: `दस्तावेज़ अपलोड किया गया: ${newDoc.type}`,
                timestamp: new Date().toISOString(),
                icon: 'fa-file-upload'
            });
            localStorage.setItem('userActivity', JSON.stringify(userActivity));
            
            showToast('दस्तावेज़ सफलतापूर्वक सहेजा गया!', 'success');
            closeAllModals();
            
            // Refresh the uploaded documents list if we're in a form
            if (document.getElementById('uploadedDocumentsPreview')) {
                renderUploadedDocuments();
            }
        }

        function initiatePayment() {
            const form = document.getElementById('nivaranx-application-form');
            // Basic form validation
            if (!form.checkValidity()) {
                showToast("कृपया सभी ज़रूरी फ़ील्ड भरें।", "error");
                form.reportValidity(); // Show browser's validation messages
                return;
            }

            const formData = new FormData(form);
            currentFormData = Object.fromEntries(formData.entries());
            
            const service = currentServiceForForm; // Moved declaration here to fix ReferenceError
            // Handle checkbox values as arrays
            if (service && service.formFields) {
                for (const section of service.formFields) {
                    for (const field of section.fields) {
                        if (field.type === 'checkbox') {
                            const checkboxes = form.querySelectorAll(`input[name="${field.name}"]:checked`);
                            currentFormData[field.name] = Array.from(checkboxes).map(cb => cb.value);
                        }
                    }
                }
            }

            
            const modalContent = document.getElementById('paymentModalContent');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-credit-card"></i> भुगतान गेटवे</h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div class="payment-amount">
                    <div class="amount-label">${service.name} के लिए कुल राशि</div>
                    <div class="amount-value">₹${service.fees.total}</div>
                </div>
                <p style="text-align:center; opacity:0.7; font-size:0.9rem;">यह एक सुरक्षित भुगतान गेटवे सिमुलेशन है।</p>
                <div class="form-actions" style="flex-direction: column; gap: 10px;">
                    <button class="btn btn-primary" onclick="processPayment()">
                        <i class="fas fa-shield-alt"></i> सुरक्षित रूप से भुगतान करें
                    </button>
                    <button class="btn btn-outline" onclick="openFormModal()">फॉर्म पर वापस</button>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <h3 style="font-size: 1rem; margin-bottom: 10px; color: var(--primary);">भुगतान का प्रमाण अपलोड करें (वैकल्पिक)</h3>
                    <button class="btn btn-outline" onclick="document.getElementById('paymentScreenshotInput').click()">
                        <i class="fas fa-upload"></i> स्क्रीनशॉट अपलोड करें
                    </button>
                    <div id="paymentScreenshotPreview" style="margin-top: 10px;">
                        ${paymentScreenshot ? `<img src="${paymentScreenshot}" alt="भुगतान स्क्रीनशॉट" style="max-width: 100%; max-height: 150px; border-radius: 8px; margin-top: 10px;">` : '<p style="opacity:0.7; font-size:0.8rem;">भुगतान के बाद स्क्रीनशॉट अपलोड करें</p>'}
                    </div>
                </div>`;
            
            closeAllModals();
            document.getElementById('paymentModal').classList.add('active');
        }

        function handlePaymentScreenshotUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                paymentScreenshot = event.target.result;
                const previewDiv = document.getElementById('paymentScreenshotPreview');
                previewDiv.innerHTML = `<img src="${paymentScreenshot}" alt="भुगतान स्क्रीनशॉट" style="max-width: 100%; max-height: 150px; border-radius: 8px; margin-top: 10px;">`;
                showToast('भुगतान स्क्रीनशॉट अपलोड किया गया!', 'success');
            };
            reader.readAsDataURL(file);
            e.target.value = ''; // Clear file input
        }

        function processPayment() {
            showToast("भुगतान प्रसंस्करण...", "info");
            setTimeout(() => {
                showReceipt();
            }, 1500);
        }

        function showReceipt() {
            const service = currentServiceForForm;
            const appId = `NX${Math.floor(100000 + Math.random() * 900000)}`;
            const txnId = `TXN${Date.now()}`;
            currentFormData.appId = appId;
            currentFormData.txnId = txnId;

            // Add to activity
            userActivity.unshift({
                description: `आवेदन किया गया: ${service.name} (ID: ${appId})`,
                timestamp: new Date().toISOString(),
                icon: service.icon
            });
            localStorage.setItem('userActivity', JSON.stringify(userActivity));
            
            const modalContent = document.getElementById('receiptModalContent');
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2 class="modal-title" style="color: var(--success);">
                        <i class="fas fa-check-circle"></i> आवेदन प्राप्त हुआ
                    </h2>
                    <button class="close-modal" onclick="closeAllModals()">&times;</button>
                </div>
                <div class="receipt-details">
                    <div class="receipt-row">
                        <span class="receipt-label">आवेदन ID</span>
                        <span class="receipt-value">${appId}</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">सेवा का नाम</span>
                        <span class="receipt-value">${service.name}</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">आवेदक का नाम</span>
                        <span class="receipt-value">${currentFormData.firstName || currentFormData.fullName || ''} ${currentFormData.lastName || ''}</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">भुगतान की गई राशि</span>
                        <span class="receipt-value" style="color:var(--success);">₹${service.fees.total}</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">लेन-देन ID</span>
                        <span class="receipt-value">${txnId}</span>
                    </div>
                </div>
                <div class="receipt-actions">
                    <button class="btn btn-outline" onclick="downloadFilledPDF()">
                        <i class="fas fa-download"></i> फॉर्म डाउनलोड करें
                    </button>
                    <button class="btn btn-primary" onclick="uploadToWhatsApp()">
                        <i class="fab fa-whatsapp"></i> व्हाट्सएप पर भेजें
                    </button>
                    <button class="btn btn-outline" onclick="emailPDF()">
                        <i class="fas fa-envelope"></i> ईमेल PDF
                    </button>
                </div>`;
            
            closeAllModals();
            document.getElementById('receiptModal').classList.add('active');
        }

        function downloadFilledPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const service = currentServiceForForm;
            const data = currentFormData;

            doc.setFontSize(18);
            doc.setTextColor(108, 77, 246);
            doc.text('NIVARANX आवेदन पत्र', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(0,0,0);
            doc.text(`सेवा: ${service.name}`, 20, 40);
            doc.text(`आवेदन ID: ${data.appId}`, 20, 47);
            doc.text(`दिनांक: ${new Date().toLocaleDateString('hi-IN')}`, 140, 47);

            doc.line(20, 55, 190, 55);
            
            let yOffset = 65;
            const lineHeight = 7;

            // Iterate through formFields to add to PDF
            if (service.formFields && service.formFields.length > 0) {
                service.formFields.forEach(section => {
                    // Check if new section fits on current page, if not, add new page
                    if (yOffset + 20 > 280) { 
                        doc.addPage();
                        yOffset = 20;
                    }
                    doc.setFontSize(14);
                    doc.text(`${section.title}`, 20, yOffset);
                    yOffset += lineHeight;
                    doc.setFontSize(10);
                    section.fields.forEach(field => {
                        let fieldValue = data[field.name];
                        if (Array.isArray(fieldValue)) {
                            fieldValue = fieldValue.join(', '); // For checkboxes
                        }
                        if (field.type === 'date' && fieldValue) {
                            fieldValue = new Date(fieldValue).toLocaleDateString('hi-IN');
                        }
                        if (field.label && fieldValue !== undefined && fieldValue !== null && fieldValue !== "") { // Ensure value exists
                            // Check if content fits on current page
                            if (yOffset > 280) { // If near bottom, add new page
                                doc.addPage();
                                yOffset = 20;
                                doc.setFontSize(10); // Reset font size after page break
                            }
                            doc.text(`${field.label}: ${fieldValue}`, 20, yOffset);
                            yOffset += lineHeight;
                        }
                    });
                    yOffset += lineHeight * 0.5; // Add some space between sections
                });
            } else {
                // Fallback to generic fields if no specific formFields are defined
                doc.setFontSize(14);
                doc.text('व्यक्तिगत विवरण', 20, yOffset); yOffset += lineHeight;
                doc.setFontSize(10);
                doc.text(`नाम: ${data.title || ''} ${data.firstName || ''} ${data.middleName || ''} ${data.lastName || ''}`, 20, yOffset); yOffset += lineHeight;
                doc.text(`लिंग: ${data.gender || ''}`, 20, yOffset); yOffset += lineHeight;
                doc.text(`जन्म तिथि: ${data.dob ? new Date(data.dob).toLocaleDateString('hi-IN') : ''}`, 20, yOffset); yOffset += lineHeight;
                doc.text(`पिता का नाम: ${data.fatherName || ''}`, 20, yOffset); yOffset += lineHeight;
                doc.text(`माता का नाम: ${data.motherName || ''}`, 20, yOffset); yOffset += lineHeight;
                doc.text(`वैवाहिक स्थिति: ${data.maritalStatus || ''}`, 20, yOffset); yOffset += lineHeight;
                
                yOffset += lineHeight;
                doc.setFontSize(14);
                doc.text('पता और संपर्क', 20, yOffset); yOffset += lineHeight;
                doc.setFontSize(10);
                doc.text(`वर्तमान पता: ${data.address1 || ''}, ${data.address2 || ''}, ${data.district || ''}, ${data.state || ''} - ${data.pincode || ''}, ${data.country || ''}`, 20, yOffset); yOffset += lineHeight;
                if (data.sameAsCurrent !== 'on') { 
                    doc.text(`स्थायी पता: ${data.permAddress1 || ''}, ${data.permAddress2 || ''}, ${data.permDistrict || ''}, ${data.permState || ''} - ${data.permPincode || ''}, ${data.permCountry || ''}`, 20, yOffset); yOffset += lineHeight;
                }
                doc.text(`मोबाइल: ${data.mobile || ''}`, 20, yOffset); yOffset += lineHeight;
                doc.text(`ईमेल: ${data.email || ''}`, 20, yOffset); yOffset += lineHeight;
                doc.text(`आधार: ${data.aadhaar || 'N/A'}`, 20, yOffset); yOffset += lineHeight;
                doc.text(`पैन: ${data.pan || 'N/A'}`, 20, yOffset); yOffset += lineHeight;

                yOffset += lineHeight;
                doc.setFontSize(14);
                doc.text('अतिरिक्त जानकारी', 20, yOffset); yOffset += lineHeight;
                doc.setFontSize(10);
                doc.text(`शिक्षा: ${data.education || 'N/A'}`, 20, yOffset); yOffset += lineHeight;
                doc.text(`व्यवसाय: ${data.occupation || 'N/A'}`, 20, yOffset); yOffset += lineHeight;
                doc.text(`वार्षिक आय: ₹${data.income || 'N/A'}`, 20, yOffset); yOffset += lineHeight;
            }

            // Add payment screenshot if available
            if (paymentScreenshot) {
                if (yOffset + 60 > 280) { // Check if space is enough for image
                    doc.addPage();
                    yOffset = 20;
                }
                doc.setFontSize(14);
                doc.text('भुगतान का प्रमाण', 20, yOffset);
                yOffset += lineHeight;
                doc.addImage(paymentScreenshot, 'JPEG', 20, yOffset, 80, 50); // Adjust size as needed
                yOffset += 55; // Space after image
            }

            // Ensure declaration is always at the bottom, adjust yOffset
            if (yOffset > 240) { // If content exceeds current page, add new page
                doc.addPage();
                yOffset = 20;
            }
            doc.line(20, yOffset, 190, yOffset); yOffset += lineHeight;
            doc.setFontSize(10);
            doc.text("घोषणा: मैं घोषणा करता/करती हूं कि प्रदान की गई सभी जानकारी सही है।", 20, yOffset); yOffset += lineHeight;
            doc.text(`स्थान: ${data.place || 'N/A'}`, 20, yOffset); yOffset += lineHeight;
            doc.text(`दिनांक: ${new Date(data.declarationDate).toLocaleDateString('hi-IN')}`, 20, yOffset); yOffset += lineHeight;
            doc.text("आवेदक के हस्ताक्षर: (NIVARANX पर डिजिटल रूप से हस्ताक्षरित)", 20, yOffset);

            doc.save(`${data.appId}_${service.name}_फॉर्म.pdf`);
            showToast("फॉर्म डाउनलोड हो रहा है...", "success");
        }

        function uploadToWhatsApp() {
            // In a real app, you would send the PDF file. Here, we just open WhatsApp with a message.
            const phone = "918603980072"; // NivaranX WhatsApp Number
            const message = `नमस्ते NIVARANX टीम,\n\nमैंने ${currentServiceForForm.name} के लिए अपना आवेदन ID: ${currentFormData.appId} के साथ जमा कर दिया है। मैं आपके संदर्भ के लिए डाउनलोड किया गया फॉर्म संलग्न कर रहा/रही हूं।\n\nधन्यवाद।`;
            const url = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
            showToast("व्हाट्सएप पर रीडायरेक्ट कर रहा है...", "info");
        }

        function emailPDF() {
            // In a real app, you would send the PDF file. Here, we just open the email client.
            const subject = `NIVARANX आवेदन - ${currentServiceForForm.name} (ID: ${currentFormData.appId})`;
            const body = `नमस्ते NIVARANX टीम,\n\nमैंने ${currentServiceForForm.name} के लिए अपना आवेदन ID: ${currentFormData.appId} के साथ जमा कर दिया है। कृपया संलग्न फॉर्म देखें।\n\nधन्यवाद।`;
            const email = `info.upadhyayg@gmail.com`;
            const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.open(mailtoLink, '_blank');
            showToast("ईमेल क्लाइंट खोल रहा है...", "info");
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => modal.classList.remove('active'));
            
            // Stop camera if scanner is open
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
        }

        // --- AI Chatbot Functions ---
        function setupChatbot() {
            const toggle = document.getElementById('chatbotToggle');
            const container = document.getElementById('chatbotContainer');
            const closeBtn = document.getElementById('chatbotClose');
            const sendBtn = document.getElementById('chatbotSend');
            const input = document.getElementById('chatbotInput');
            const messages = document.getElementById('chatbotMessages');
            
            toggle.addEventListener('click', () => {
                chatbotOpen = !chatbotOpen;
                if (chatbotOpen) {
                    container.classList.add('open');
                } else {
                    container.classList.remove('open');
                }
            });
            
            closeBtn.addEventListener('click', () => {
                chatbotOpen = false;
                container.classList.remove('open');
            });
            
            sendBtn.addEventListener('click', sendMessage);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
        }
        
        function showChatbot() {
            chatbotOpen = true;
            document.getElementById('chatbotContainer').classList.add('open');
            closeAllModals();
        }
        
        async function sendMessage() {
            const input = document.getElementById('chatbotInput');
            const messages = document.getElementById('chatbotMessages');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'message user-message';
            userMsg.textContent = message;
            messages.appendChild(userMsg);
            
            // Clear input
            input.value = '';
            
            // Scroll to bottom
            messages.scrollTop = messages.scrollHeight;
            
            // Simulate typing indicator
            const typing = document.createElement('div');
            typing.className = 'message bot-message';
            typing.innerHTML = '<i class="fas fa-ellipsis-h"></i>';
            messages.appendChild(typing);
            messages.scrollTop = messages.scrollHeight;
            
            // Process after delay
            try {
                const response = await getChatbotResponse(message);
                messages.removeChild(typing);
                const botMsg = document.createElement('div');
                botMsg.className = 'message bot-message';
                botMsg.textContent = response;
                messages.appendChild(botMsg);
                messages.scrollTop = messages.scrollHeight;
            } catch (error) {
                messages.removeChild(typing);
                const errorMsg = document.createElement('div');
                errorMsg.className = 'message bot-message error';
                errorMsg.textContent = 'क्षमा करें, AI सहायक से प्रतिक्रिया प्राप्त करने में त्रुटि हुई।';
                messages.appendChild(errorMsg);
                messages.scrollTop = messages.scrollHeight;
                console.error("Chatbot API error:", error);
            }
        }
        
        async function getChatbotResponse(message) {
            const lowerMsg = message.toLowerCase();
            
            // Check for greetings
            if (lowerMsg.includes('hi') || lowerMsg.includes('hello') || lowerMsg.includes('namaste')) {
                return randomResponse(chatbotKnowledge.greetings);
            }
            
            // Check for about questions
            if (lowerMsg.includes('what is nivaranx') || lowerMsg.includes('about nivaranx') || lowerMsg.includes('who are you')) {
                return randomResponse(chatbotKnowledge.about);
            }
            
            // Check for founder questions
            if (lowerMsg.includes('founder') || lowerMsg.includes('who made') || lowerMsg.includes('rishu') || lowerMsg.includes('upadhyay')) {
                return randomResponse(chatbotKnowledge.founder);
            }
            
            // Check for services questions
            if (lowerMsg.includes('service') || lowerMsg.includes('offer') || lowerMsg.includes('provide') || lowerMsg.includes('what services')) {
                return randomResponse(chatbotKnowledge.services);
            }
            
            // Check for benefits questions
            if (lowerMsg.includes('benefit') || lowerMsg.includes('advantage') || lowerMsg.includes('why use')) {
                return randomResponse(chatbotKnowledge.benefits);
            }
            
            // Check for contact questions
            if (lowerMsg.includes('contact') || lowerMsg.includes('reach') || lowerMsg.includes('number') || lowerMsg.includes('email') || lowerMsg.includes('address')) {
                return randomResponse(chatbotKnowledge.contact);
            }
            
            // Check for payment questions
            if (lowerMsg.includes('pay') || lowerMsg.includes('payment') || lowerMsg.includes('fee') || lowerMsg.includes('cost')) {
                return randomResponse(chatbotKnowledge.payment);
            }
            
            // Check for document questions
            if (lowerMsg.includes('document') || lowerMsg.includes('require') || lowerMsg.includes('need') || lowerMsg.includes('upload')) {
                return randomResponse(chatbotKnowledge.documents);
            }

            // Check for OCR questions
            if (lowerMsg.includes('ocr') || lowerMsg.includes('auto fill') || lowerMsg.includes('scan document')) {
                return randomResponse(chatbotKnowledge.ocr_info);
            }
            
            // Check for help questions
            if (lowerMsg.includes('help') || lowerMsg.includes('support') || lowerMsg.includes('assist') || lowerMsg.includes('faq')) {
                return randomResponse(chatbotKnowledge.help);
            }

            // Check for updates questions
            if (lowerMsg.includes('update') || lowerMsg.includes('news') || lowerMsg.includes('announcement')) {
                return randomResponse(chatbotKnowledge.updates_info);
            }

            // Check for profile questions
            if (lowerMsg.includes('profile') || lowerMsg.includes('my account') || lowerMsg.includes('my documents')) {
                return randomResponse(chatbotKnowledge.profile_info);
            }

            // Check for home questions
            if (lowerMsg.includes('home') || lowerMsg.includes('main page')) {
                return randomResponse(chatbotKnowledge.home_info);
            }

            // Check for discover questions
            if (lowerMsg.includes('discover') || lowerMsg.includes('mission') || lowerMsg.includes('vision') || lowerMsg.includes('values')) {
                return randomResponse(chatbotKnowledge.discover_info);
            }
            
            // If no specific match, use Gemini API for a more general response
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: message }] });
            const payload = { contents: chatHistory };
            const apiKey = ""; // Leave as-is, Canvas will provide it
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                return result.candidates[0].content.parts[0].text;
            } else {
                return randomResponse(chatbotKnowledge.default);
            }
        }
        
        function randomResponse(responses) {
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // --- Login & User Management ---
        function renderAuthForm(isLogin = true) {
            const container = document.getElementById('auth-container');
            if (isLogin) {
                container.innerHTML = `
                    <div class="login-form">
                        <div class="form-group">
                            <label class="form-label">मोबाइल नंबर</label>
                            <input type="tel" class="form-control" id="loginMobile" placeholder="10-अंकीय मोबाइल नंबर">
                        </div>
                        <div class="form-group">
                            <label class="form-label">पासवर्ड</label>
                            <input type="password" class="form-control" id="loginPassword" placeholder="आपका पासवर्ड">
                        </div>
                        <button class="btn btn-primary" onclick="handleLogin()">
                            <i class="fas fa-sign-in-alt"></i> लॉगिन करें
                        </button>
                        <div class="form-footer">
                            खाता नहीं है? <a href="#" onclick="renderAuthForm(false)">रजिस्टर करें</a>
                        </div>
                    </div>`;
            } else {
                container.innerHTML = `
                    <div class="login-form">
                        <div class="form-group">
                            <label class="form-label">पूरा नाम</label>
                            <input type="text" class="form-control" id="regName" placeholder="आपका पूरा नाम">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ईमेल</label>
                            <input type="email" class="form-control" id="regEmail" placeholder="आपका ईमेल पता">
                        </div>
                        <div class="form-group">
                            <label class="form-label">मोबाइल नंबर</label>
                            <input type="tel" class="form-control" id="regMobile" placeholder="10-अंकीय मोबाइल नंबर">
                        </div>
                        <div class="form-group">
                            <label class="form-label">पासवर्ड बनाएं</label>
                            <input type="password" class="form-control" id="regPassword" placeholder="एक मजबूत पासवर्ड">
                        </div>
                        <button class="btn btn-primary" onclick="handleRegister()">
                            <i class="fas fa-user-plus"></i> रजिस्टर करें
                        </button>
                        <div class="form-footer">
                            पहले से खाता है? <a href="#" onclick="renderAuthForm(true)">लॉगिन करें</a>
                        </div>
                    </div>`;
            }
        }

        function handleRegister() {
            const users = JSON.parse(localStorage.getItem('nivaranx_users') || '{}');
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const mobile = document.getElementById('regMobile').value;
            const password = document.getElementById('regPassword').value;

            if (!name || !email.includes('@') || mobile.length < 10 || password.length < 6) { 
                showToast('कृपया सभी जानकारी सही से भरें (मोबाइल: 10 अंक, पासवर्ड: न्यूनतम 6 वर्ण, ईमेल: वैध)।', 'error'); 
                return; 
            }
            if (users[mobile]) { 
                showToast('यह मोबाइल नंबर पहले से पंजीकृत है।', 'error'); 
                return; 
            }

            users[mobile] = { 
                name, 
                email, 
                password, 
                mobile, 
                joined: new Date().toISOString() 
            };
            localStorage.setItem('nivaranx_users', JSON.stringify(users));
            showToast('पंजीकरण सफल! अब लॉगिन करें।', 'success');
            renderAuthForm(true);
        }

        function handleLogin() {
            const users = JSON.parse(localStorage.getItem('nivaranx_users') || '{}');
            const mobile = document.getElementById('loginMobile').value;
            const password = document.getElementById('loginPassword').value;

            const user = users[mobile];
            if (user && user.password === password) {
                isLoggedIn = true;
                currentUser = user;
                sessionStorage.setItem('nivaranx_currentUser', JSON.stringify(user));
                closeAllModals();
                showMainApp();
                showToast(`स्वागत है, ${user.name}!`, 'success');
            } else {
                showToast('गलत मोबाइल नंबर या पासवर्ड।', 'error');
            }
        }
        
        function logout() {
            isLoggedIn = false;
            currentUser = null;
            sessionStorage.removeItem('nivaranx_currentUser');
            closeAllModals();
            document.querySelector('.app-header').classList.remove('visible');
            document.querySelector('.app-container').classList.remove('visible');
            document.querySelector('.bottom-nav').classList.remove('visible');
            document.getElementById('loginModal').classList.add('active');
            renderAuthForm(true);
            showToast("आप सफलतापूर्वक लॉगआउट हो गए हैं।", "info");
        }

        function checkLoginState() {
            const userJson = sessionStorage.getItem('nivaranx_currentUser');
            if (userJson) {
                isLoggedIn = true;
                currentUser = JSON.parse(userJson);
            } else {
                renderAuthForm(true);
            }
        }

        // --- Navigation ---
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                if (!isLoggedIn) { 
                    showToast('कृपया पहले लॉगिन करें।', 'error'); 
                    document.getElementById('loginModal').classList.add('active'); // Ensure login modal is shown
                    return; 
                }
                
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
                
                closeAllModals();
                const target = this.dataset.target;
                if (target === 'home') {
                    populateServiceCards(''); // Reset search filter on home
                } else if (target === 'profile') {
                    renderProfileModal();
                    document.getElementById('profileModal').classList.add('active');
                } else if (target === 'discover') {
                    document.getElementById('discoverModal').classList.add('active');
                } else if (target === 'updates') {
                    document.getElementById('updatesModal').classList.add('active');
                }
            });
        });

        // --- Utility Functions ---
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast-notification');
            toast.textContent = message;
            toast.className = 'show';
            if (type === 'success') toast.classList.add('success');
            if (type === 'error') toast.classList.add('error');
            if (type === 'info') toast.classList.add('info');
            if (type === 'warning') toast.classList.add('warning');
            setTimeout(() => { 
                toast.className = toast.className.replace('show', ''); 
            }, 3000);
        }

        // --- AI Eligibility Checker Function ---
        async function checkEligibilityWithAI() {
            const query = document.getElementById('eligibilityQuery').value.trim();
            const resultsDiv = document.getElementById('eligibilityResults');

            if (!query) {
                showToast('कृपया अपनी ज़रूरतें बताएं।', 'warning');
                return;
            }

            resultsDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> सुझाव ढूंढ रहा है...';
            resultsDiv.classList.add('loading');
            resultsDiv.classList.remove('error');

            // Prepare a simplified list of services for the LLM to refer to
            let servicesList = "";
            for (const categoryKey in serviceData) {
                servicesList += `\n${serviceData[categoryKey].name} Services:\n`;
                serviceData[categoryKey].services.forEach(service => {
                    servicesList += `- ${service.name} (Fees: ${typeof service.fees.total === 'number' ? '₹' + service.fees.total : service.fees.total})\n`;
                });
            }

            const prompt = `You are an AI assistant for the NIVARANX government services portal. Your task is to help users find relevant government services based on their needs.
            
            Here is a list of services available on NIVARANX:
            ${servicesList}

            User's request: "${query}"

            Based on the user's request, suggest up to 3 most relevant services from the list above. For each suggested service, briefly explain why it's relevant. If no relevant services are found, state that. Respond in Hindi.`;

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "AIzaSyBLfjTR6pkk8xYGSeNH1JpFz_nue6w1JD8"; // Leave as-is, Canvas will provide it
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    resultsDiv.innerHTML = text;
                    resultsDiv.classList.remove('loading');
                    showToast('सुझाव प्राप्त हुए!', 'success');
                } else {
                    resultsDiv.innerHTML = 'क्षमा करें, सुझाव प्राप्त नहीं हो सके। कृपया पुनः प्रयास करें।';
                    resultsDiv.classList.remove('loading');
                    resultsDiv.classList.add('error');
                    showToast('सुझाव प्राप्त करने में विफल।', 'error');
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                resultsDiv.innerHTML = 'सुझाव प्राप्त करने में त्रुटि हुई। कृपया अपना इंटरनेट कनेक्शन जांचें या बाद में पुनः प्रयास करें।';
                resultsDiv.classList.remove('loading');
                resultsDiv.classList.add('error');
                showToast('API त्रुटि!', 'error');
            }
        }
    </script>
</body>
</html>
