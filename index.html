<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NivaranX™</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        :root{--p:#0af;--s:#555;--a:#f46;--d:#1a1a1a;--l:#eee;--cb:#282828;--cbd:#444;--ib:#3a3a3a;--ibd:#555}
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:'Poppins',sans-serif;background:var(--d);color:var(--l);line-height:1.6;min-height:100vh;display:flex;flex-direction:column}
        h1,h2,h3{font-weight:700;color:var(--l);margin-bottom:15px}
        h2{font-size:1.5rem}h3{font-size:1.3rem;margin-top:20px;text-align:left}
        .cont{max-width:100%;padding:0;flex:1;display:flex;flex-direction:column}
        .head{padding:15px;background:#121212;position:sticky;top:0;z-index:100;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,.3)}
        .head h1{font-size:1.6rem;flex-grow:1;text-align:center;color:var(--p)}
        .h-icns{display:flex;align-items:center}
        .h-icn{color:var(--l);font-size:1.3rem;margin-left:15px;cursor:pointer}
        .main{flex:1;padding:15px;max-width:800px;margin:0 auto;width:100%}
        .sec{display:none;animation:fadeIn .5s ease-in-out}
        .sec.active{display:block}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        .w-card{background:var(--cb);border-radius:8px;padding:20px;margin-bottom:20px;border:1px solid var(--cbd);box-shadow:0 2px 8px rgba(0,0,0,.2)}
        .w-card h2{font-size:1.4rem;margin-bottom:10px;text-align:left}
        .w-card p{font-size:.9rem;color:rgba(255,255,255,.8);margin-bottom:15px}
        .q-acts{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:10px}
        .q-act{background:#333;border-radius:6px;padding:12px;text-align:center;font-size:.75rem;font-weight:600;cursor:pointer;transition:background .2s ease;border:1px solid #555;color:var(--l)}
        .q-act:hover{background:#444}
        .q-act i{display:block;font-size:1.2rem;margin-bottom:8px;color:var(--p)}
        .cat-s{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:10px}
        .cat-c{background:var(--cb);border-radius:8px;border:1px solid var(--cbd);padding:15px 10px;text-align:center;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease;box-shadow:0 2px 8px rgba(0,0,0,.2)}
        .cat-c:hover{transform:translateY(-3px);box-shadow:0 4px 10px rgba(0,0,0,.3)}
        .cat-i{font-size:2rem;color:var(--p);margin-bottom:8px}
        .cat-n{font-size:.85rem;font-weight:600;color:var(--l)}
        .back-btn{background:none;border:none;color:var(--p);font-size:.95rem;margin-bottom:15px;display:flex;align-items:center;cursor:pointer;padding:5px;border-radius:5px;transition:background .2s ease}
        .back-btn:hover{background:rgba(0,170,255,.1)}
        .back-btn i{margin-right:8px}
        .srch-c{margin:15px 0;position:relative}
        .srch-i{width:100%;padding:12px 12px 12px 40px;border-radius:20px;border:1px solid var(--ibd);background:var(--ib);color:var(--l);font-size:.9rem;transition:border-color .2s ease}
        .srch-i:focus{border-color:var(--p);outline:none}
        .srch-icn{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:var(--s);font-size:1.1rem}
        .svc-l{list-style:none;padding:0}
        .svc-l li{margin-bottom:8px}
        .svc-l a{display:flex;align-items:center;padding:12px;color:var(--l);border-radius:6px;background:var(--cb);text-decoration:none;border:1px solid var(--cbd);transition:background .2s ease}
        .svc-l a:hover{background:#333}
        .svc-l i{margin-right:12px;color:var(--p);font-size:1.1rem}
        .svc-d{background:var(--cb);border-radius:8px;padding:20px;margin-top:20px;border:1px solid var(--cbd);box-shadow:0 2px 8px rgba(0,0,0,.2)}
        .svc-d h3{font-size:1.3rem;margin-bottom:10px;text-align:left}
        .svc-d p,.svc-d ul{font-size:.9rem;color:rgba(255,255,255,.8);margin-bottom:10px}
        .svc-d ul{padding-left:20px}
        .svc-d li{margin-bottom:5px}
        .svc-d a{color:var(--a);text-decoration:none;font-weight:600;transition:color .2s ease}
        .svc-d a:hover{color:#f68}
        .part-form, .app-form{background:var(--cb);border-radius:8px;padding:20px;margin-top:20px;border:1px solid var(--cbd);box-shadow:0 2px 8px rgba(0,0,0,.2)}
        .part-form label, .app-form label{display:block;margin-bottom:8px;font-weight:600;color:var(--l)}
        .part-form input, .part-form textarea, .app-form input, .app-form select, .app-form textarea{width:100%;padding:10px;margin-bottom:15px;border-radius:5px;border:1px solid var(--ibd);background:var(--ib);color:var(--l);font-size:.9rem}
        .part-form button, .app-form button{background:var(--p);color:var(--d);border:none;padding:12px 20px;border-radius:5px;cursor:pointer;font-size:1rem;font-weight:700;transition:background .2s ease}
        .part-form button:hover, .app-form button:hover{background:#0cf}
        .footer{padding:15px;text-align:center;background:#121212;font-size:.75rem;color:rgba(255,255,255,.5);margin-top:auto}
        .message-box{position:fixed;inset:0;background:rgba(0,0,0,.75);display:flex;align-items:center;justify-content:center;z-index:50}
        .message-box .inner{background:var(--cb);padding:24px;border-radius:8px;text-align:center;max-width:400px;width:100%;border:1px solid var(--cbd)}
        .message-box p{font-size:1rem;color:var(--l);margin-bottom:16px}
        .message-box button{background:var(--p);color:var(--d);padding:8px 16px;border-radius:5px;font-weight:600;cursor:pointer}
        .message-box button:hover{background:#0cf}
        @media (max-width:480px){
            .head h1{font-size:1.4rem}
            .h-icn{font-size:1.1rem;margin-left:10px}
            .main{padding:10px}
            .w-card{padding:15px}
            .w-card h2{font-size:1.2rem}
            .q-acts{grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:8px}
            .q-act{padding:10px;font-size:.7rem}
            .q-act i{font-size:1rem;margin-bottom:5px}
            h3{font-size:1.1rem;margin-top:15px;margin-bottom:10px}
            .cat-s{grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:8px}
            .cat-c{padding:12px 8px}
            .cat-i{font-size:1.8rem}
            .cat-n{font-size:.75rem}
            .srch-i{padding:10px 10px 10px 35px;font-size:.85rem}
            .srch-icn{left:10px;font-size:1rem}
            .svc-l a{padding:10px}
            .svc-l i{margin-right:10px;font-size:1rem}
            .svc-d{padding:15px}
            .svc-d h3{font-size:1.1rem}
            .svc-d p,.svc-d ul{font-size:.85rem}
            .part-form input, .part-form textarea, .app-form input, .app-form select, .app-form textarea{font-size:.85rem}
            .part-form button, .app-form button{font-size:.9rem;padding:10px 15px}
            .footer{padding:10px;font-size:.7rem}
        }
    </style>
</head>
<body>
    <div class="cont">
        <header class="head">
            <h1>NivaranX™</h1>
            <div class="h-icns">
                <i class="fas fa-search h-icn" id="g-srch-icn"></i>
                <i class="fas fa-headset h-icn" id="sup-icn"></i>
            </div>
            <div class="srch-c" id="g-srch-c" style="display: none; width: 100%; position: absolute; top: 60px; left: 0; background: #1a1a1a; padding: 10px 15px;">
                <i class="fas fa-search srch-icn"></i>
                <input type="text" class="srch-i" id="g-srch-i" placeholder="Search all services...">
            </div>
        </header>
        <main class="main">
            <section class="sec active" id="homeSec">
                <div class="w-card">
                    <h2>WELCOME TO NIVARANX™</h2>
                    <p>YOUR ONE-STOP SOLUTION FOR ALL GOVERNMENT AND PRIVATE SERVICES. GET ASSISTANCE WITH DOCUMENTS, APPLICATIONS, AND MORE.</p>
                    <div class="q-acts">
                        <div class="q-act" data-svc="pan" data-sec="national"><i class="fas fa-address-card"></i> PAN CARD</div>
                        <div class="q-act" data-svc="aadhaar" data-sec="national"><i class="fas fa-id-badge"></i> AADHAR CARD</div>
                        <div class="q-act" data-svc="voter" data-sec="national"><i class="fas fa-vote-yea"></i> VOTER CARD</div>
                        <div class="q-act" id="apply-service-btn"><i class="fas fa-file-alt"></i> APPLY SERVICE</div>
                        <div class="q-act" id="refer-btn"><i class="fas fa-user-friends"></i> REFER A FRIEND</div>
                    </div>
                </div>
                <h3>OUR SERVICES</h3>
                <div class="cat-s">
                    <div class="cat-c" data-sec="national"><div class="cat-i"><i class="fas fa-globe-asia"></i></div><div class="cat-n">NATIONAL</div></div>
                    <div class="cat-c" data-sec="state"><div class="cat-i"><i class="fas fa-landmark"></i></div><div class="cat-n">STATES</div></div>
                    <div class="cat-c" data-sec="tax"><div class="cat-i"><i class="fas fa-receipt"></i></div><div class="cat-n">TAXES</div></div>
                    <div class="cat-c" data-sec="banking"><div class="cat-i"><i class="fas fa-university"></i></div><div class="cat-n">BANKING</div></div>
                    <div class="cat-c" data-sec="insurance"><div class="cat-i"><i class="fas fa-shield-alt"></i></div><div class="cat-n">INSURANCE</div></div>
                    <div class="cat-c" data-sec="loans"><div class="cat-i"><i class="fas fa-hand-holding-usd"></i></div><div class="cat-n">LOANS</div></div>
                    <div class="cat-c" data-sec="booking"><div class="cat-i"><i class="fas fa-calendar-check"></i></div><div class="cat-n">BOOKING</div></div>
                    <div class="cat-c" data-sec="design"><div class="cat-i"><i class="fas fa-paint-brush"></i></div><div class="cat-n">DESIGNS</div></div>
                    <div class="cat-c" data-sec="partner"><div class="cat-i"><i class="fas fa-handshake"></i></div><div class="cat-n">JOIN AS A PARTNER</div></div>
                </div>
            </section>
            <section class="sec" id="applicationFormSec">
                <button class="back-btn" id="backToHomeBtn"><i class="fas fa-arrow-left"></i> Back to Home</button>
                <div class="w-card">
                    <h2>Service Application Form</h2>
                    <p class="text-sm text-gray-400 mb-4">Please fill out the form below to apply for a service. Service provision time period: 2-7 Working Days.</p>
                    <form id="serviceApplicationForm" class="app-form">
                        <label for="serviceName">Services Name:</label>
                        <select id="serviceName" required class="rounded-md">
                            <option value="" disabled selected>Select a service</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                        <label for="fullName">Name:</label>
                        <input type="text" id="fullName" placeholder="Your Full Name" required class="rounded-md">
                        <label for="fatherName">Father's Name:</label>
                        <input type="text" id="fatherName" placeholder="Father's Full Name" required class="rounded-md">
                        <label for="motherName">Mother's Name:</label>
                        <input type="text" id="motherName" placeholder="Mother's Full Name" required class="rounded-md">
                        <label for="state">State:</label>
                        <input type="text" id="state" placeholder="Your State" required class="rounded-md">
                        <label for="district">District:</label>
                        <input type="text" id="district" placeholder="Your District" required class="rounded-md">
                        <label for="block">Block:</label>
                        <input type="text" id="block" placeholder="Your Block" class="rounded-md">
                        <label for="subdivision">Subdivision:</label>
                        <input type="text" id="subdivision" placeholder="Your Subdivision" class="rounded-md">
                        <label for="villageCityTown">Village/City/Town:</label>
                        <input type="text" id="villageCityTown" placeholder="Your Village/City/Town" required class="rounded-md">
                        <label for="wardNo">Ward No.:</label>
                        <input type="text" id="wardNo" placeholder="Your Ward Number" class="rounded-md">
                        <label for="postOffice">Post Office:</label>
                        <input type="text" id="postOffice" placeholder="Your Post Office" required class="rounded-md">
                        <label for="policeStation">Police Station:</label>
                        <input type="text" id="policeStation" placeholder="Your Police Station" required class="rounded-md">
                        <label for="mobileNo">Mobile No.:</label>
                        <input type="tel" id="mobileNo" placeholder="e.g., +919876543210" required class="rounded-md">
                        <label for="emailId">Email ID:</label>
                        <input type="email" id="emailId" placeholder="your.email@example.com" required class="rounded-md">
                        <label for="applicationDateTime">Date & Time of Application:</label>
                        <input type="text" id="applicationDateTime" readonly class="rounded-md bg-gray-600 cursor-not-allowed">
                        <label for="declarationText">DECLARATION:</label>
                        <textarea id="declarationText" rows="6" readonly class="rounded-md bg-gray-700 text-gray-200 cursor-not-allowed text-sm"></textarea>
                        <div class="flex items-center mb-4">
                            <input type="checkbox" id="agreeDeclaration" required class="mr-2">
                            <label for="agreeDeclaration" class="mb-0">I agree to the above declaration.</label>
                        </div>
                        <button type="submit" class="w-full mt-4">Proceed to Payment</button>
                    </form>
                </div>
            </section>
            <!-- Other sections from the first file -->
            <section class="sec" id="nationalSec">
                <button class="back-btn"><i class="fas fa-arrow-left"></i> Back</button>
                <h2>National Services</h2>
                <ul class="svc-l">
                    <li><a href="#" data-svc="voter"><i class="fas fa-vote-yea"></i> Voter ID</a></li>
                    <li><a href="#" data-svc="ration"><i class="fas fa-address-card"></i> Ration Card</a></li>
                    <li><a href="#" data-svc="pan"><i class="fas fa-address-card"></i> PAN Card</a></li>
                    <li><a href="#" data-svc="aadhaar"><i class="fas fa-id-badge"></i> Aadhaar Card</a></li>
                    <li><a href="#" data-svc="passport"><i class="fas fa-passport"></i> Passport</a></li>
                    <li><a href="#" data-svc="driving"><i class="fas fa-car"></i> Driving Licence</a></li>
                    <li><a href="#" data-svc="udyam"><i class="fas fa-industry"></i> UDYAM Registration</a></li>
                    <li><a href="#" data-svc="pmay"><i class="fas fa-home"></i> PMAY Scheme</a></li>
                </ul>
                <div class="svc-d" id="nationalDet"></div>
            </section>
            <!-- Include other sections (stateSec, taxSec, bankingSec, etc.) similarly -->
            <section class="sec" id="partnerSec">
                <button class="back-btn"><i class="fas fa-arrow-left"></i> Back</button>
                <h2>Join As a Partner</h2>
                <div class="part-form">
                    <p style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.8);">Join the digital revolution with just a smartphone and internet connection. No physical office needed - operate from anywhere in your city!</p>
                    <p style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.8);">Smart Phone (High-end Camera)<br>High-Speed Internet Connection<br>Power Bank for Mobile Operations<br>100% Virtual Setup - Work From Anywhere</p>
                    <p style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.8);">We provide: AI-powered Digital Marketing Kits, Virtual Reality Training, and IdentityCard.</p>
                    <p style="margin-bottom: 20px; color: var(--p); font-weight: bold;">Franchise Fee: ₹599 + 18% GST = ₹706.82</p>
                    <label for="p-name">Name:</label>
                    <input type="text" id="p-name" placeholder="Your Name">
                    <label for="p-email">Email:</label>
                    <input type="email" id="p-email" placeholder="Your Email">
                    <label for="p-phone">Phone Number:</label>
                    <input type="tel" id="p-phone" placeholder="Your Phone Number">
                    <label for="p-city">City:</label>
                    <input type="text" id="p-city" placeholder="Your City">
                    <label for="p-state">State:</label>
                    <input type="text" id="p-state" placeholder="Your State">
                    <label for="p-zip">Zip Code:</label>
                    <input type="text" id="p-zip" placeholder="Your Zip Code">
                    <label for="p-rcode">Refer Code:</label>
                    <input type="text" id="p-rcode" placeholder="Enter Refer Code (Optional)">
                    <label for="p-why">Why join NivaranX™?</label>
                    <textarea id="p-why" rows="4" placeholder="Tell us about your interest..."></textarea>
                    <button id="send-p-wa">Send via WhatsApp</button>
                </div>
            </section>
            <div id="messageBox" class="message-box hidden">
                <div class="inner">
                    <p id="messageText"></p>
                    <div id="paymentDetails" class="hidden text-left mt-4 p-3 bg-gray-700 rounded-md border border-blue-500">
                        <h3 class="text-md font-bold text-blue-400 mb-2">Payment Details:</h3>
                        <p class="text-gray-200">UPI ID: <span class="font-semibold">7903476191@apl</span></p>
                        <p class="text-green-400 text-sm mt-1 flex items-center">
                            <i class="fas fa-check-circle mr-1"></i> Verified UPI ID
                        </p>
                    </div>
                    <div id="shareOptions" class="hidden mt-4">
                        <p class="text-gray-300 text-sm mb-2">Share the downloaded PDF:</p>
                        <a id="emailShareLink" href="#" target="_blank" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md inline-flex items-center mr-2 mb-2">
                            <i class="fas fa-envelope mr-2"></i> Email
                        </a>
                        <a id="whatsappShareLink" href="#" target="_blank" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md inline-flex items-center mb-2">
                            <i class="fab fa-whatsapp mr-2"></i> WhatsApp
                        </a>
                    </div>
                    <button id="closeMessageBox">OK</button>
                </div>
            </div>
        </main>
        <footer class="footer">
            <p>© 2025 NivaranX™ - UPADHYAYG GROUP</p>
        </footer>
    </div>
    <script>
        // Service data from the first file
        const serviceData = {
            voter: { name: "Voter ID", desc: "ID for voting.", process: ["Apply on NVSP.", "Submit docs.", "Verify.", "Get card."], docs: ["Aadhaar", "Photo"], applyTime: "~10m", receiveDays: "2-10d", wa: "https://wa.me/918603980072?text=Hello!%20*NivaranX™*%20ke%20saath%20*Voter%20ID*%20banane%20mein%20meri%20help%20karen!" },
            // Include other service data entries similarly
        };

        // Element references
        const secs = document.querySelectorAll('.sec');
        const catCs = document.querySelectorAll('.cat-c');
        const qActs = document.querySelectorAll('.q-act');
        const backBtns = document.querySelectorAll('.back-btn');
        const svcLs = document.querySelectorAll('.svc-l a');
        const gSrchIcn = document.getElementById('g-srch-icn');
        const gSrchC = document.getElementById('g-srch-c');
        const gSrchI = document.getElementById('g-srch-i');
        const supIcn = document.getElementById('sup-icn');
        const referBtn = document.getElementById('refer-btn');
        const applyServiceBtn = document.getElementById('apply-service-btn');
        const backToHomeBtn = document.getElementById('backToHomeBtn');
        const serviceApplicationForm = document.getElementById('serviceApplicationForm');
        const serviceNameSelect = document.getElementById('serviceName');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const closeMessageBox = document.getElementById('closeMessageBox');
        const shareOptions = document.getElementById('shareOptions');
        const emailShareLink = document.getElementById('emailShareLink');
        const whatsappShareLink = document.getElementById('whatsappShareLink');
        const declarationTextarea = document.getElementById('declarationText');
        const agreeDeclarationCheckbox = document.getElementById('agreeDeclaration');
        const paymentDetails = document.getElementById('paymentDetails');
        const applicationDateTimeInput = document.getElementById('applicationDateTime');

        // Official contact details
        const officialEmail = 'info.upadhyayg@gmail.com';
        const officialWhatsApp = '+918603980072';
        const officialUpiId = '7903476191@apl';
        const upiRecipientName = 'RISHU RAJ UPADHYAY';

        // Declaration text template
        const baseDeclarationText = `I, [Applicant's Name], hereby declare that all the information, particulars, and documents provided by me in this application form are true, complete, and accurate to the best of my knowledge and belief.

I understand that any false, incomplete, or misleading information provided by me may lead to the rejection of my application or cancellation of any approved service, and in such a situation, no refund will be provided.

I also acknowledge that the estimated service provision time period is 2-7 working days.

I authorize NivaranX™ Paperless Services Limited to verify the information provided in this application.`;

        let viewHist = ['home'];
        let pdfDataUrl = ''; // Store PDF data URL for WhatsApp sharing

        // Populate service dropdown
        function populateServiceDropdown() {
            for (const svcKey in serviceData) {
                const option = document.createElement('option');
                option.value = svcKey;
                option.textContent = serviceData[svcKey].name;
                serviceNameSelect.appendChild(option);
            }
        }

        // Show section
        function showSec(secId) {
            secs.forEach(sec => sec.classList.remove('active'));
            document.getElementById(secId).classList.add('active');
            gSrchC.style.display = 'none';
            gSrchI.value = '';
            resetSvcLs();
            if (secId === 'applicationFormSec') {
                const now = new Date();
                applicationDateTimeInput.value = now.toLocaleString();
                updateDeclarationText();
            }
        }

        // Show service details
        function showSvcDet(secId, svcKey) {
            const detDiv = document.getElementById(`${secId}Det`);
            const s = serviceData[svcKey];
            if (s) {
                detDiv.innerHTML = `<h3>${s.name}</h3><p><strong>Description:</strong> ${s.desc}</p><p><strong>Steps:</strong></p><ul>${s.process.map(step => `<li>${step}</li>`).join('')}</ul><p><strong>Required Docs:</strong></p><ul>${s.docs.map(doc => `<li>${doc}</li>`).join('') || '<li>None</li>'}</ul><p><strong>Time:</strong> ${s.applyTime}</p><p><strong>Delivery:</strong> ${s.receiveDays}</p><p><a href="${s.wa}" target="_blank" style="color:var(--a);font-weight:bold;">Ask Expert on WhatsApp</a></p>`;
                detDiv.classList.add('active');
            }
        }

        // Hide service details
        function hideSvcDet(secId) {
            const detDiv = document.getElementById(`${secId}Det`);
            detDiv.classList.remove('active');
            detDiv.innerHTML = '';
        }

        // Reset service list
        function resetSvcLs() {
            document.querySelectorAll('.svc-l li').forEach(item => item.style.display = 'block');
        }

        // Generate refer code
        function generateReferCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code + 'UG';
        }

        // Show message box
        function showMessageBox(message, showShareOptions = false, showPayment = false) {
            messageText.textContent = message;
            shareOptions.classList.toggle('hidden', !showShareOptions);
            paymentDetails.classList.toggle('hidden', !showPayment);
            messageBox.classList.remove('hidden');
        }

        // Update declaration text
        function updateDeclarationText() {
            const fullName = document.getElementById('fullName').value;
            declarationTextarea.value = baseDeclarationText.replace("[Applicant's Name]", fullName || '[Applicant\'s Name]');
        }

        // Razorpay payment integration
        function initiatePayment(formData, callback) {
            const options = {
                key: 'YOUR_RAZORPAY_KEY_ID', // Replace with your Razorpay Key ID
                amount: 10000, // Amount in paise (e.g., 100.00 INR)
                currency: 'INR',
                name: 'NivaranX™ Paperless Services',
                description: `Payment for ${formData['Services Name']}`,
                handler: function (response) {
                    console.log('Payment successful:', response);
                    callback(formData); // Proceed with PDF generation and download
                },
                prefill: {
                    name: formData['Name'],
                    email: formData['Email ID'],
                    contact: formData['Mobile No.']
                },
                notes: {
                    transaction_id: `TXN_${Date.now()}`
                },
                theme: {
                    color: '#00aaff'
                }
            };
            const rzp = new Razorpay(options);
            rzp.on('payment.failed', function (response) {
                showMessageBox('Payment failed. Please try again.');
            });
            rzp.open();
        }

        // Generate PDF
        function generatePdf(data) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 15;

            // Header
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(0, 170, 255);
            doc.setFontSize(20);
            doc.text("NivaranX™ Paperless Services Limited", pageWidth / 2, 20, { align: 'center' });
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(50, 50, 50);
            doc.setFontSize(10);
            doc.text("Your ONE-STOP solutions for all Government and Private Services.", pageWidth / 2, 28, { align: 'center' });
            doc.text("Get assistance with documents, applications, and more.", pageWidth / 2, 34, { align: 'center' });
            doc.setDrawColor(0, 170, 255);
            doc.setLineWidth(0.5);
            doc.line(margin, 45, pageWidth - margin, 45);

            // Form Details
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(0, 170, 255);
            doc.text("Service Application Details", margin, 60);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(51, 51, 51);

            let y = 70;
            let serialNo = 1;
            for (const key in data) {
                if (key === 'Declaration') continue;
                if (y > pageHeight - 100) {
                    doc.addPage();
                    y = margin + 10;
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(0, 170, 255);
                    doc.setFontSize(16);
                    doc.text("NivaranX™ Paperless Services Limited", pageWidth / 2, 20, { align: 'center' });
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(50, 50, 50);
                    doc.setFontSize(10);
                    doc.text("Your ONE-STOP solutions for all Government and Private Services.", pageWidth / 2, 28, { align: 'center' });
                    doc.text("Get assistance with documents, applications, and more.", pageWidth / 2, 34, { align: 'center' });
                    doc.setDrawColor(0, 170, 255);
                    doc.setLineWidth(0.5);
                    doc.line(margin, 45, pageWidth - margin, 45);
                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(0, 170, 255);
                    doc.text("Service Application Details (Continued)", margin, 60);
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(51, 51, 51);
                    y = 70;
                }
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(0, 100, 200);
                doc.text(`${serialNo}. ${key}:`, margin, y);
                const keyWidth = doc.getStringUnitWidth(`${serialNo}. ${key}:`) * doc.internal.getFontSize() / doc.internal.scaleFactor;
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(51, 51, 51);
                doc.text(data[key], margin + keyWidth + 2, y);
                y += 7;
                serialNo++;
            }

            // Declaration
            y += 10;
            const declarationTitleHeight = 8;
            const declarationLineHeight = 5;
            const signatureLineHeight = 7;
            const declarationTextLines = doc.splitTextToSize(data['Declaration'], pageWidth - (2 * margin));
            const requiredDeclarationHeight = declarationTitleHeight + (declarationTextLines.length * declarationLineHeight) + (3 * signatureLineHeight) + 15;
            if (y + requiredDeclarationHeight > pageHeight - 40) {
                doc.addPage();
                y = margin + 10;
            }
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(0, 170, 255);
            doc.text("DECLARATION", margin, y);
            y += 8;
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(51, 51, 51);
            const declarationPoints = [
                `1. I, ${data['Name'] || '[Applicant\'s Name]'}, hereby declare that all the information, particulars, and documents provided by me in this application form are true, complete, and accurate to the best of my knowledge and belief.`,
                `2. I understand that any false, incomplete, or misleading information provided by me may lead to the rejection of my application or cancellation of any approved service, and in such a situation, no refund will be provided.`,
                `3. I also acknowledge that the estimated service provision time period is 2-7 working days.`,
                `4. I authorize NivaranX™ Paperless Services Limited to verify the information provided in this application.`
            ];
            declarationPoints.forEach(point => {
                const pointLines = doc.splitTextToSize(point, pageWidth - (2 * margin));
                doc.text(pointLines, margin, y);
                y += (pointLines.length * declarationLineHeight);
            });
            y += 5;
            doc.setFont('times', 'italic');
            doc.setFontSize(12);
            doc.text(`Applicant's Signature: ${data['Name'] || '_________________________'} (Digitally Captured Name)`, margin, y);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            y += 7;
            const applicationDate = data['Date & Time of Application'] ? data['Date & Time of Application'].split(',')[0].trim() : '_________________________';
            const applicationPlace = data['Village/City/Town'] || '_________________________';
            doc.text(`Date: ${applicationDate}`, margin, y);
            y += 7;
            doc.text(`Place: ${applicationPlace}`, margin, y);
            y += 10;

            // Footer
            const footerY = pageHeight - 40;
            doc.setDrawColor(0, 170, 255);
            doc.setLineWidth(0.5);
            doc.line(margin, footerY, pageWidth - margin, footerY);
            doc.setFontSize(9);
            doc.setTextColor(0, 170, 255);
            doc.setFont('helvetica', 'bold');
            const footerLines = [
                "NivaranX™ Paperless Services Limited",
                "Panchpokhari, Near Gajna Dham Mandir, Nabinagar, Aurangabad, Bihar - 824302",
                "Contact Us: Email - info.upadhyayg@gmail.com, pH No.: +91 8603980072, Web: https://nivaranx.godaddysites.com/"
            ];
            let currentFooterY = footerY + 10;
            footerLines.forEach(line => {
                const textWidth = doc.getStringUnitWidth(line) * doc.internal.getFontSize() / doc.internal.scaleFactor;
                doc.text(line, (pageWidth - textWidth) / 2, currentFooterY);
                currentFooterY += 5;
            });

            // Save PDF and prepare for WhatsApp sharing
            pdfDataUrl = doc.output('datauristring');
            doc.save("NivaranX_Service_Application.pdf");
        }

        // Event listeners
        catCs.forEach(card => {
            card.addEventListener('click', () => {
                const secId = card.getAttribute('data-sec');
                if (secId === 'partner') {
                    if (viewHist[viewHist.length - 1] !== 'home') viewHist.push('home');
                    viewHist.push('partnerSec');
                    showSec('partnerSec');
                } else {
                    const targetSecId = secId + 'Sec';
                    if (viewHist[viewHist.length - 1] !== 'home') viewHist.push('home');
                    viewHist.push(targetSecId);
                    showSec(targetSecId);
                    hideSvcDet(secId);
                }
            });
        });

        qActs.forEach(action => {
            action.addEventListener('click', () => {
                const svcKey = action.getAttribute('data-svc');
                const secId = action.getAttribute('data-sec') ? action.getAttribute('data-sec') + 'Sec' : null;
                if (svcKey && secId) {
                    if (viewHist[viewHist.length - 1] !== 'home') viewHist.push('home');
                    viewHist.push(secId);
                    viewHist.push(svcKey);
                    showSec(secId);
                    showSvcDet(secId.replace('Sec', ''), svcKey);
                } else if (action.id === 'apply-service-btn') {
                    if (viewHist[viewHist.length - 1] !== 'home') viewHist.push('home');
                    viewHist.push('applicationFormSec');
                    showSec('applicationFormSec');
                } else {
                    alert("Feature coming soon!");
                }
            });
        });

        svcLs.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const svcKey = link.getAttribute('data-svc');
                const secId = link.closest('.sec').id;
                viewHist.push(svcKey);
                showSvcDet(secId.replace('Sec', ''), svcKey);
            });
        });

        backBtns.forEach(button => {
            button.addEventListener('click', () => {
                viewHist.pop();
                const prevView = viewHist[viewHist.length - 1];
                if (prevView === 'home') {
                    showSec('homeSec');
                    viewHist = ['home'];
                } else if (prevView.endsWith('Sec')) {
                    showSec(prevView);
                    hideSvcDet(prevView.replace('Sec', ''));
                    resetSvcLs();
                } else {
                    showSec('homeSec');
                    viewHist = ['home'];
                }
            });
        });

        gSrchIcn.addEventListener('click', () => {
            gSrchC.style.display = gSrchC.style.display === 'none' ? 'block' : 'none';
            if (gSrchC.style.display === 'block') {
                gSrchI.focus();
            } else {
                gSrchI.value = '';
                resetSvcLs();
                const lastView = viewHist[viewHist.length - 1];
                if (lastView && lastView !== 'home') {
                    showSec(lastView.endsWith('Sec') ? lastView : lastView + 'Sec');
                } else {
                    showSec('homeSec');
                }
            }
        });

        gSrchI.addEventListener('input', e => {
            const term = e.target.value.toLowerCase();
            hideSvcDet(viewHist[viewHist.length - 1].replace('Sec', ''));
            let foundMatch = false;
            secs.forEach(sec => {
                if (sec.id !== 'homeSec' && sec.id !== 'partnerSec' && sec.id !== 'applicationFormSec') {
                    sec.classList.remove('active');
                    const svcList = sec.querySelector('.svc-l');
                    if (svcList) {
                        const items = svcList.querySelectorAll('li');
                        let sectionHasMatch = false;
                        items.forEach(item => {
                            const svcLink = item.querySelector('a');
                            const svcKey = svcLink.getAttribute('data-svc');
                            const svc = serviceData[svcKey];
                            const svcName = svc.name.toLowerCase();
                            const svcDesc = svc.desc.toLowerCase();
                            if (svcName.includes(term) || svcDesc.includes(term)) {
                                item.style.display = 'block';
                                sectionHasMatch = true;
                                foundMatch = true;
                            } else {
                                item.style.display = 'none';
                            }
                        });
                        if (sectionHasMatch && term.length > 0) {
                            sec.classList.add('active');
                        }
                    }
                }
            });
            if (term.length === 0) {
                resetSvcLs();
                const lastView = viewHist[viewHist.length - 1];
                if (lastView && lastView !== 'home') {
                    showSec(lastView.endsWith('Sec') ? lastView : lastView + 'Sec');
                } else {
                    showSec('homeSec');
                }
            } else {
                document.getElementById('homeSec').classList.remove('active');
                document.getElementById('partnerSec').classList.remove('active');
                document.getElementById('applicationFormSec').classList.remove('active');
            }
        });

        supIcn.addEventListener('click', () => {
            const msg = encodeURIComponent('Hello NivaranX, I need support regarding a service.');
            window.open(`https://wa.me/${officialWhatsApp}?text=${msg}`, '_blank');
        });

        referBtn.addEventListener('click', () => {
            const referCode = generateReferCode();
            const message = encodeURIComponent(`नमस्ते! मैं आपको NivaranX™ के साथ डिजिटल क्रांति में शामिल होने के लिए आमंत्रित करता हूँ। यह एक वन-स्टॉप प्लेटफ़ॉर्म है सरकारी और निजी सेवाओं के लिए।\n\nबिना किसी ऑफिस के, अपने स्मार्टफोन और इंटरनेट से कहीं से भी काम करें।\n\nवेबसाइट देखें: https://nivaranx.godaddysites.com/#\n\nमेरा रेफरल कोड: ${referCode}\n\nआज ही जुड़ें और डिजिटल इंडिया का हिस्सा बनें!\n#NivaranX #DigitalIndia #PartnerOpportunity`);
            window.open(`https://wa.me/?text=${message}`, '_blank');
        });

        document.getElementById('send-p-wa').addEventListener('click', () => {
            const name = document.getElementById('p-name').value;
            const email = document.getElementById('p-email').value;
            const phone = document.getElementById('p-phone').value;
            const city = document.getElementById('p-city').value;
            const state = document.getElementById('p-state').value;
            const zip = document.getElementById('p-zip').value;
            const rcode = document.getElementById('p-rcode').value;
            const why = document.getElementById('p-why').value;
            if (!name || !phone || !email || !city || !state || !zip || !why) {
                showMessageBox('Please fill all required fields (Name, Email, Phone, City, State, Zip Code, Why join).');
                return;
            }
            if (rcode && !rcode.toUpperCase().endsWith('UG')) {
                showMessageBox('Invalid Refer Code format. It should end with UG.');
                return;
            }
            const waMsg = encodeURIComponent(`Partner Inquiry:\nName: ${name}\nEmail: ${email}\nPhone: ${phone}\nCity: ${city}\nState: ${state}\nZip Code: ${zip}\nRefer Code: ${rcode || 'N/A'}\nWhy join: ${why}`);
            window.open(`https://wa.me/${officialWhatsApp}?text=${waMsg}`, '_blank');
        });

        applyServiceBtn.addEventListener('click', () => {
            showSec('applicationFormSec');
        });

        document.getElementById('fullName').addEventListener('input', updateDeclarationText);

        serviceApplicationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (!agreeDeclarationCheckbox.checked) {
                showMessageBox('Please tick the checkbox to agree to the declaration.');
                return;
            }
            const formData = {
                'Services Name': serviceNameSelect.options[serviceNameSelect.selectedIndex].text,
                'Service Key': serviceNameSelect.value,
                'Name': document.getElementById('fullName').value,
                "Father's Name": document.getElementById('fatherName').value,
                "Mother's Name": document.getElementById('motherName').value,
                'State': document.getElementById('state').value,
                'District': document.getElementById('district').value,
                'Block': document.getElementById('block').value,
                'Subdivision': document.getElementById('subdivision').value,
                'Village/City/Town': document.getElementById('villageCityTown').value,
                'Ward No.': document.getElementById('wardNo').value,
                'Post Office': document.getElementById('postOffice').value,
                'Police Station': document.getElementById('policeStation').value,
                'Mobile No.': document.getElementById('mobileNo').value,
                'Email ID': document.getElementById('emailId').value,
                'Date & Time of Application': document.getElementById('applicationDateTime').value,
                'Service provision time period': '2-7 Working Days',
                'Declaration': declarationTextarea.value
            };
            initiatePayment(formData, (data) => {
                generatePdf(data);
                const emailSubject = encodeURIComponent('NivaranX™ Service Application Form');
                const emailBody = encodeURIComponent(`Hello! I have filled out a service application form on NivaranX™. Please review the attached PDF.\n\nApplication Details:\n${Object.entries(data).map(([key, value]) => `${key}: ${value}`).join('\n')}`);
                emailShareLink.href = `mailto:${officialEmail}?subject=${emailSubject}&body=${emailBody}`;
                const whatsappMessage = encodeURIComponent(`Hello! I have filled out a service application form for ${data['Services Name']} on NivaranX™. Please review the attached PDF.`);
                whatsappShareLink.href = `https://wa.me/${officialWhatsApp}?text=${whatsappMessage}`;
                showMessageBox('Payment successful! Your application has been submitted, and the PDF has been downloaded.', true, false);
            });
        });

        closeMessageBox.addEventListener('click', () => {
            messageBox.classList.add('hidden');
            showSec('homeSec');
            serviceApplicationForm.reset();
            agreeDeclarationCheckbox.checked = false;
            const now = new Date();
            applicationDateTimeInput.value = now.toLocaleString();
            updateDeclarationText();
        });

        // Initialize
        populateServiceDropdown();
        showSec('homeSec');
    </script>
</body>
</html>
